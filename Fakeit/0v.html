<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>페이크잇 - 파티게임</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: manipulation;
        }

        .container {
            width: 100%;
            max-width: 400px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 600px;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .back-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
        }

        .page {
            display: none;
            padding: 30px;
            text-align: center;
            min-height: 500px;
        }

        .page.active {
            display: block;
        }

        .btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 18px;
            text-align: center;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            border-color: #667eea;
        }

        .counter {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }

        .counter-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .counter-btn.minus {
            background: #ff6b6b;
            color: white;
        }

        .counter-btn.plus {
            background: #51cf66;
            color: white;
        }

        .counter-value {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            min-width: 60px;
        }

        .invite-code {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px dashed #667eea;
        }

        .code {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            letter-spacing: 8px;
            margin: 10px 0;
        }

        .question-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
            text-align: left;
        }

        .question-type {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 18px;
            color: #333;
            line-height: 1.5;
        }

        .answer-input {
            width: 100%;
            min-height: 100px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 16px;
            resize: vertical;
            outline: none;
            margin: 20px 0;
        }

        .canvas {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            margin: 20px 0;
            cursor: crosshair;
        }

        .voting-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .player-btn {
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .player-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .score-counter {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .hidden {
            display: none !important;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .emoji-btn {
            padding: 10px;
            font-size: 24px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
        }

        .emoji-btn.selected {
            background: #667eea;
            border-color: #667eea;
        }

        @media (max-width: 480px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 15px;
            }
            
            .page {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 첫 페이지 -->
        <div id="home-page" class="page active">
            <div class="header">
                <h1>🎭 페이크잇</h1>
                <p>파티게임의 새로운 차원</p>
            </div>
            <div style="padding: 30px;">
                <button class="btn btn-primary" onclick="showPage('host-setup')">
                    🎯 호스트로 시작하기
                </button>
                <button class="btn btn-secondary" onclick="showPage('join-game')">
                    🚀 방 참여하기
                </button>
            </div>
        </div>

        <!-- 호스트 설정 페이지 -->
        <div id="host-setup" class="page">
            <div class="header">
                <button class="back-btn" onclick="showPage('home-page')">←</button>
                <h2>게임 설정</h2>
            </div>
            
            <div class="input-group">
                <label>전체 인원수</label>
                <div class="counter">
                    <button class="counter-btn minus" onclick="changePlayerCount(-1)">-</button>
                    <span class="counter-value" id="total-players">4</span>
                    <button class="counter-btn plus" onclick="changePlayerCount(1)">+</button>
                </div>
            </div>

            <div class="input-group">
                <label>페이커 인원수</label>
                <div class="counter">
                    <button class="counter-btn minus" onclick="changeFakerCount(-1)">-</button>
                    <span class="counter-value" id="faker-count">1</span>
                    <button class="counter-btn plus" onclick="changeFakerCount(1)">+</button>
                </div>
            </div>

            <button class="btn btn-success" onclick="generateInviteCodes()">
                초대코드 생성하기
            </button>
        </div>

        <!-- 초대코드 표시 페이지 -->
        <div id="invite-codes" class="page">
            <div class="header">
                <button class="back-btn" onclick="showPage('host-setup')">←</button>
                <h2>초대코드</h2>
            </div>
            
            <div id="codes-container"></div>
            
            <button class="btn btn-primary" onclick="startHostGame()">
                게임 시작하기
            </button>
        </div>

        <!-- 방 참여 페이지 -->
        <div id="join-game" class="page">
            <div class="header">
                <button class="back-btn" onclick="showPage('home-page')">←</button>
                <h2>방 참여</h2>
            </div>
            
            <div class="input-group">
                <label>초대코드 입력</label>
                <input type="text" id="invite-code-input" placeholder="4자리 알파벳 입력" 
                       maxlength="4" style="text-transform: uppercase;">
            </div>

            <button class="btn btn-success" onclick="joinGame()">
                참여하기
            </button>
        </div>

        <!-- 게임 진행 페이지 -->
        <div id="game-page" class="page">
            <div class="header">
                <h2 id="game-header">라운드 1</h2>
                <p id="role-display"></p>
            </div>
            
            <div id="question-container">
                <div class="question-box">
                    <div class="question-type" id="question-type">입력형 질문</div>
                    <div class="question-text" id="question-text"></div>
                </div>

                <div id="answer-section">
                    <textarea class="answer-input" id="answer-input" placeholder="여기에 답을 입력하세요..."></textarea>
                    <canvas id="drawing-canvas" class="canvas hidden" width="350" height="200"></canvas>
                    <div id="emoji-section" class="hidden">
                        <div class="emoji-grid" id="emoji-grid"></div>
                    </div>
                    <div id="player-select" class="hidden">
                        <div class="voting-buttons" id="player-voting"></div>
                    </div>
                </div>

                <button class="btn btn-primary" id="submit-answer" onclick="submitAnswer()">
                    답변 제출
                </button>

                <div id="after-submit" class="hidden">
                    <button class="btn btn-secondary" onclick="revealAnswer()">
                        답 공개
                    </button>
                </div>

                <div id="reveal-section" class="hidden">
                    <h3>내 답변</h3>
                    <div id="my-answer" class="question-box"></div>
                    
                    <div id="faker-hint" class="hidden">
                        <h4>실제 질문:</h4>
                        <div class="question-box">
                            <div class="question-text" id="real-question"></div>
                        </div>
                    </div>

                    <h3>페이커 찾기</h3>
                    <div class="voting-buttons" id="voting-section"></div>
                </div>
            </div>

            <div id="host-controls" class="hidden">
                <h3>점수 관리</h3>
                <div id="score-management"></div>
                
                <button class="btn btn-danger" onclick="fakerGiveUp()">
                    페이커 포기
                </button>
                
                <button class="btn btn-secondary" id="reveal-faker-btn" onclick="revealFaker()">
                    페이커 공개
                </button>
                
                <button class="btn btn-success hidden" onclick="nextRound()">
                    다음 라운드
                </button>
            </div>

            <div id="player-controls" class="hidden">
                <button class="btn btn-danger" onclick="fakerGiveUp()">
                    페이커 포기
                </button>
            </div>
        </div>
    </div>

    <script>
        // 게임 상태
        let gameState = {
            totalPlayers: 4,
            fakerCount: 1,
            currentRound: 1,
            isHost: false,
            isFaker: false,
            playerRole: '',
            inviteCodes: [],
            currentAnswer: '',
            questions: [],
            currentQuestionType: 'input',
            scores: {},
            votes: {}
        };

        // 알파벳 세트 데이터
        const alphabetSets = {
            set1: [
                {letters: ['y', 'b', 'g', 'd'], numbers: [19, 29, 27, 7]},
                {letters: ['z', 'a', 'o', 'r'], numbers: [5, 11, 25, 19]},
                {letters: ['x', 'v', 'u', 't'], numbers: [8, 25, 26, 11]},
                {letters: ['q', 'p', 's', 'f'], numbers: [29, 16, 13, 17]},
                {letters: ['c', 'k', 'w', 'e'], numbers: [14, 22, 24, 3]},
                {letters: ['h', 'n', 'm', 'j'], numbers: [11, 6, 30, 10]}
            ],
            set2: [
                {letters: ['r', 'q', 'd', 'k'], numbers: [20, 14, 4, 15]},
                {letters: ['f', 'o', 'n', 'y'], numbers: [27, 9, 28, 6]},
                {letters: ['g', 'z', 'b', 'w'], numbers: [10, 15, 14, 25]},
                {letters: ['e', 't', 'v', 'u'], numbers: [12, 8, 6, 18]},
                {letters: ['a', 'c', 'p', 's'], numbers: [4, 27, 19, 8]},
                {letters: ['x', 'j', 'm', 'h'], numbers: [24, 2, 8, 23]}
            ],
            set3: [
                {letters: ['t', 'b', 'p', 'e'], numbers: [28, 5, 1, 26]},
                {letters: ['a', 'u', 'f', 'x'], numbers: [22, 19, 18, 20]},
                {letters: ['v', 'm', 'r', 'w'], numbers: [3, 20, 17, 13]},
                {letters: ['s', 'n', 'g', 'y'], numbers: [6, 28, 7, 22]},
                {letters: ['k', 'q', 'o', 'h'], numbers: [21, 7, 22, 2]},
                {letters: ['z', 'j', 'c', 'd'], numbers: [26, 3, 2, 9]}
            ],
            set4: [
                {letters: ['f', 'g', 'm', 'q'], numbers: [15, 26, 23, 29]},
                {letters: ['p', 'j', 'v', 'y'], numbers: [23, 17, 29, 21]},
                {letters: ['k', 'r', 'h', 'o'], numbers: [16, 24, 15, 4]},
                {letters: ['z', 'u', 'e', 's'], numbers: [9, 23, 20, 27]},
                {letters: ['t', 'n', 'a', 'w'], numbers: [1, 30, 5, 24]},
                {letters: ['c', 'd', 'x', 'b'], numbers: [7, 13, 21, 16]}
            ]
        };

        // 질문 데이터베이스
        const questionDB = {
            1: {type: 'input', main: '생일날에 먹고 싶은 것은?', fake: '돌잔치에서 먹고 싶은 것은?'},
            2: {type: 'input', main: '가장 좋아하는 음식은?', fake: '가장 싫어하는 음식은?'},
            3: {type: 'input', main: '여행가고 싶은 나라는?', fake: '살고 싶지 않은 나라는?'},
            4: {type: 'drawing', main: '뾰족이를 그려주세요', fake: '불룩이를 그려주세요'},
            5: {type: 'number', main: '이번 년도에 싸운 횟수는?', fake: '이번 년도에 비행기 탄 횟수는?'},
            6: {type: 'emoji', main: '자신을 표현하는 이모지는?', fake: '자신이 자주 안 쓰는 이모지는?'},
            7: {type: 'player', main: '가장 애인이 많았을 것 같은 플레이어는?', fake: '달리기가 가장 빠를 것 같은 플레이어는?'},
            8: {type: 'input', main: '어릴 때 장래희망은?', fake: '부모님의 직업은?'},
            9: {type: 'input', main: '가장 무서워하는 것은?', fake: '가장 자신 있는 것은?'},
            10: {type: 'drawing', main: '집을 그려주세요', fake: '자동차를 그려주세요'},
            11: {type: 'number', main: '하루에 몇 시간 잠을 자나요?', fake: '하루에 몇 번 웃나요?'},
            12: {type: 'input', main: '가장 기억에 남는 선물은?', fake: '가장 비싼 선물은?'},
            13: {type: 'input', main: '스트레스 받을 때 하는 일은?', fake: '행복할 때 하는 일은?'},
            14: {type: 'input', main: '가장 좋아하는 계절은?', fake: '가장 싫어하는 계절은?'},
            15: {type: 'drawing', main: '강아지를 그려주세요', fake: '고양이를 그려주세요'},
            16: {type: 'number', main: '핸드폰을 하루에 몇 시간 사용하나요?', fake: 'TV를 하루에 몇 시간 보나요?'},
            17: {type: 'input', main: '가장 좋아하는 색깔은?', fake: '가장 싫어하는 색깔은?'},
            18: {type: 'emoji', main: '지금 기분을 이모지로 표현하면?', fake: '어제 기분을 이모지로 표현하면?'},
            19: {type: 'player', main: '가장 요리를 잘할 것 같은 플레이어는?', fake: '가장 운전을 못할 것 같은 플레이어는?'},
            20: {type: 'input', main: '가장 가고 싶은 여행지는?', fake: '가장 가기 싫은 여행지는?'},
            21: {type: 'drawing', main: '나무를 그려주세요', fake: '꽃을 그려주세요'},
            22: {type: 'number', main: '일주일에 운동을 몇 번 하나요?', fake: '일주일에 영화를 몇 편 보나요?'},
            23: {type: 'input', main: '가장 좋아하는 영화 장르는?', fake: '가장 싫어하는 영화 장르는?'},
            24: {type: 'emoji', main: '가장 좋아하는 이모지는?', fake: '가장 이해 안 되는 이모지는?'},
            25: {type: 'player', main: '가장 잠이 많을 것 같은 플레이어는?', fake: '가장 일찍 일어날 것 같은 플레이어는?'},
            26: {type: 'input', main: '가장 좋아하는 운동은?', fake: '가장 싫어하는 운동은?'},
            27: {type: 'drawing', main: '햄버거를 그려주세요', fake: '피자를 그려주세요'},
            28: {type: 'number', main: '평균 몇 시에 잠자리에 드나요?', fake: '평균 몇 시에 일어나나요?'},
            29: {type: 'input', main: '가장 기억에 남는 여행은?', fake: '가장 후회되는 여행은?'},
            30: {type: 'player', main: '가장 패션 센스가 좋은 플레이어는?', fake: '가장 개그 센스가 좋은 플레이어는?'}
        };

        // 이모지 목록
        const emojis = ['😀', '😂', '😍', '😭', '😎', '🤔', '😴', '😋', '🥰', '😤', '🤯', '🥳', '😷', '🤢', '🤠', '😈', '👻', '💀', '🎭', '👹', '👺', '🤡', '💩', '👽', '🤖'];

        // 페이지 전환
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        // 플레이어 수 변경
        function changePlayerCount(delta) {
            const current = gameState.totalPlayers;
            const newValue = Math.max(3, Math.min(8, current + delta));
            gameState.totalPlayers = newValue;
            document.getElementById('total-players').textContent = newValue;
            
            // 페이커 수가 전체 인원을 초과하지 않도록 조정
            if (gameState.fakerCount >= newValue) {
                gameState.fakerCount = Math.max(1, newValue - 1);
                document.getElementById('faker-count').textContent = gameState.fakerCount;
            }
        }

        // 페이커 수 변경
        function changeFakerCount(delta) {
            const current = gameState.fakerCount;
            const maxFakers = Math.max(1, gameState.totalPlayers - 1);
            const newValue = Math.max(1, Math.min(maxFakers, current + delta));
            gameState.fakerCount = newValue;
            document.getElementById('faker-count').textContent = newValue;
        }

        // 알파벳을 숫자로 변환
        function letterToNumber(letter) {
            return letter.charCodeAt(0) - 96; // a=1, b=2, ...
        }

        // 페이커 여부 확인
        function isFakerCode(code) {
            const sum = code.split('').reduce((acc, letter) => acc + letterToNumber(letter), 0);
            const firstDigit = parseInt(sum.toString()[0]);
            return firstDigit === 3 || firstDigit === 7;
        }

        // 초대코드 생성
        function generateInviteCodes() {
            gameState.isHost = true;
            gameState.inviteCodes = [];
            
            // 각 라운드의 행 선택
            const selectedRows = [];
            for (let round = 0; round < 4; round++) {
                selectedRows.push([
                    Math.floor(Math.random() * 6), // set1 행
                    Math.floor(Math.random() * 6), // set2 행  
                    Math.floor(Math.random() * 6), // set3 행
                    Math.floor(Math.random() * 6)  // set4 행
                ]);
            }

            let fakerCodes = 0;
            const normalCodes = [];

            // 일반 플레이어 코드 생성
            for (let i = 0; i < gameState.totalPlayers - gameState.fakerCount; i++) {
                let code;
                do {
                    code = generateSingleCode(selectedRows);
                } while (isFakerCode(code));
                normalCodes.push(code);
            }

            // 페이커 코드 생성
            for (let i = 0; i < gameState.fakerCount; i++) {
                let code;
                do {
                    code = generateSingleCode(selectedRows);
                } while (!isFakerCode(code));
                gameState.inviteCodes.push(code);
            }

            // 일반 코드 추가
            gameState.inviteCodes.push(...normalCodes);

            // 코드 섞기
            gameState.inviteCodes.sort(() => Math.random() - 0.5);

            displayInviteCodes();
            showPage('invite-codes');
        }

        // 단일 코드 생성
        function generateSingleCode(selectedRows) {
            const roundIndex = Math.floor(Math.random() * 4);
            const rows = selectedRows[roundIndex];
            
            let code = '';
            const sets = ['set1', 'set2', 'set3', 'set4'];
            
            for (let i = 0; i < 4; i++) {
                const setData = alphabetSets[sets[i]][rows[i]];
                const randomLetter = setData.letters[Math.floor(Math.random() * 4)];
                code += randomLetter;
            }
            
            return code.toUpperCase();
        }

        // 초대코드 표시
        function displayInviteCodes() {
            const container = document.getElementById('codes-container');
            container.innerHTML = '';
            
            gameState.inviteCodes.forEach((code, index) => {
                const codeDiv = document.createElement('div');
                codeDiv.className = 'invite-code';
                codeDiv.innerHTML = `
                    <h4>플레이어 ${index + 1}</h4>
                    <div class="code">${code}</div>
                    <small>이 코드를 각 플레이어에게 전달하세요</small>
                `;
                container.appendChild(codeDiv);
            });
        }

        // 게임 참여
        function joinGame() {
            const code = document.getElementById('invite-code-input').value.toUpperCase();
            if (code.length !== 4) {
                alert('4자리 알파벳을 입력해주세요.');
                return;
            }

            gameState.isHost = false;
            gameState.isFaker = isFakerCode(code);
            gameState.playerRole = gameState.isFaker ? '페이커' : '일반 플레이어';
            
            // 코드로부터 질문 번호 추출
            extractQuestionsFromCode(code);
            
            startGame();
        }

        // 호스트 게임 시작
        function startHostGame() {
            // 첫 번째 코드로 질문 추출 (호스트용)
            extractQuestionsFromCode(gameState.inviteCodes[0]);
            gameState.isFaker = isFakerCode(gameState.inviteCodes[0]);
            gameState.playerRole = '호스트';
            startGame();
        }

        // 코드에서 질문 번호 추출
        function extractQuestionsFromCode(code) {
            const letters = code.toLowerCase().split('');
            gameState.questions = [];
            
            // 각 라운드별 질문 번호 추출
            for (let round = 0; round < 4; round++) {
                const roundQuestions = [];
                
                // 각 세트에서 해당 글자가 있는 행 찾기
                const sets = ['set1', 'set2', 'set3', 'set4'];
                for (let setIndex = 0; setIndex < 4; setIndex++) {
                    const setData = alphabetSets[sets[setIndex]];
                    for (let rowIndex = 0; rowIndex < setData.length; rowIndex++) {
                        if (setData[rowIndex].letters.includes(letters[setIndex])) {
                            roundQuestions.push(setData[rowIndex].numbers[setIndex]);
                            break;
                        }
                    }
                }
                
                gameState.questions.push(roundQuestions);
            }
        }

        // 게임 시작
        function startGame() {
            initializeScores();
            loadCurrentQuestion();
            showPage('game-page');
            
            if (gameState.isHost) {
                document.getElementById('host-controls').classList.remove('hidden');
                setupScoreManagement();
            } else {
                document.getElementById('player-controls').classList.remove('hidden');
            }
            
            updateGameHeader();
            updateRoleDisplay();
        }

        // 점수 초기화
        function initializeScores() {
            gameState.scores = {};
            for (let i = 0; i < gameState.totalPlayers; i++) {
                gameState.scores[`플레이어${i + 1}`] = 0;
            }
        }

        // 현재 질문 로드
        function loadCurrentQuestion() {
            const roundIndex = gameState.currentRound - 1;
            const questionNumbers = gameState.questions[roundIndex];
            const questionIndex = Math.floor(Math.random() * questionNumbers.length);
            const questionId = questionNumbers[questionIndex];
            
            const question = questionDB[questionId];
            if (!question) return;
            
            gameState.currentQuestionType = question.type;
            
            // 질문 표시
            document.getElementById('question-type').textContent = getQuestionTypeText(question.type);
            
            if (gameState.isFaker) {
                document.getElementById('question-text').textContent = question.fake;
            } else {
                document.getElementById('question-text').textContent = question.main;
            }
            
            // 답변 입력 방식 설정
            setupAnswerInput(question.type);
        }

        // 질문 타입 텍스트
        function getQuestionTypeText(type) {
            switch(type) {
                case 'input': return '📝 입력형 질문';
                case 'drawing': return '🎨 그림 모드';
                case 'number': return '🔢 숫자 모드';
                case 'emoji': return '😀 이모지 모드';
                case 'player': return '👥 플레이어 선택 모드';
                default: return '질문';
            }
        }

        // 답변 입력 방식 설정
        function setupAnswerInput(type) {
            // 모든 입력 방식 숨기기
            document.getElementById('answer-input').classList.add('hidden');
            document.getElementById('drawing-canvas').classList.add('hidden');
            document.getElementById('emoji-section').classList.add('hidden');
            document.getElementById('player-select').classList.add('hidden');
            
            switch(type) {
                case 'input':
                case 'number':
                    document.getElementById('answer-input').classList.remove('hidden');
                    if (type === 'number') {
                        document.getElementById('answer-input').type = 'number';
                        document.getElementById('answer-input').placeholder = '숫자를 입력하세요...';
                    } else {
                        document.getElementById('answer-input').type = 'text';
                        document.getElementById('answer-input').placeholder = '여기에 답을 입력하세요...';
                    }
                    break;
                case 'drawing':
                    document.getElementById('drawing-canvas').classList.remove('hidden');
                    setupCanvas();
                    break;
                case 'emoji':
                    document.getElementById('emoji-section').classList.remove('hidden');
                    setupEmojiGrid();
                    break;
                case 'player':
                    document.getElementById('player-select').classList.remove('hidden');
                    setupPlayerSelection();
                    break;
            }
        }

        // 캔버스 설정
        function setupCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            // 캔버스 초기화
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            
            // 터치 및 마우스 이벤트
            function startDrawing(e) {
                isDrawing = true;
                draw(e);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, y);
            }
            
            function stopDrawing() {
                if (!isDrawing) return;
                isDrawing = false;
                ctx.beginPath();
            }
            
            // 이벤트 리스너
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
            
            // 지우기 버튼 추가
            if (!document.getElementById('clear-canvas-btn')) {
                const clearBtn = document.createElement('button');
                clearBtn.id = 'clear-canvas-btn';
                clearBtn.className = 'btn btn-secondary';
                clearBtn.textContent = '🗑️ 지우기';
                clearBtn.onclick = () => {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                };
                canvas.parentNode.insertBefore(clearBtn, canvas.nextSibling);
            }
        }

        // 이모지 그리드 설정
        function setupEmojiGrid() {
            const grid = document.getElementById('emoji-grid');
            grid.innerHTML = '';
            
            emojis.forEach(emoji => {
                const btn = document.createElement('button');
                btn.className = 'emoji-btn';
                btn.textContent = emoji;
                btn.onclick = () => {
                    document.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    gameState.currentAnswer = emoji;
                };
                grid.appendChild(btn);
            });
        }

        // 플레이어 선택 설정
        function setupPlayerSelection() {
            const container = document.getElementById('player-select');
            const votingDiv = document.getElementById('player-voting');
            votingDiv.innerHTML = '';
            
            for (let i = 0; i < gameState.totalPlayers; i++) {
                const btn = document.createElement('button');
                btn.className = 'player-btn';
                btn.textContent = gameState.isHost && i === 0 ? '호스트' : `플레이어 ${i + 1}`;
                btn.onclick = () => {
                    document.querySelectorAll('#player-voting .player-btn').forEach(b => 
                        b.classList.remove('selected'));
                    btn.classList.add('selected');
                    gameState.currentAnswer = btn.textContent;
                };
                votingDiv.appendChild(btn);
            }
        }

        // 답변 제출
        function submitAnswer() {
            switch(gameState.currentQuestionType) {
                case 'input':
                case 'number':
                    gameState.currentAnswer = document.getElementById('answer-input').value;
                    break;
                case 'drawing':
                    gameState.currentAnswer = '그림을 그렸습니다';
                    break;
                case 'emoji':
                case 'player':
                    // 이미 선택시 저장됨
                    break;
            }
            
            if (!gameState.currentAnswer || gameState.currentAnswer.trim() === '') {
                alert('답을 입력해주세요.');
                return;
            }
            
            // 답변 숨기기
            document.getElementById('answer-section').classList.add('hidden');
            document.getElementById('submit-answer').classList.add('hidden');
            document.getElementById('after-submit').classList.remove('hidden');
        }

        // 답 공개
        function revealAnswer() {
            document.getElementById('after-submit').classList.add('hidden');
            document.getElementById('reveal-section').classList.remove('hidden');
            
            // 내 답변 표시
            document.getElementById('my-answer').innerHTML = `
                <div class="question-text">${gameState.currentAnswer}</div>
            `;
            
            // 페이커인 경우 실제 질문 표시
            if (gameState.isFaker) {
                document.getElementById('faker-hint').classList.remove('hidden');
                const roundIndex = gameState.currentRound - 1;
                const questionNumbers = gameState.questions[roundIndex];
                const questionId = questionNumbers[0];
                const realQuestion = questionDB[questionId]?.main || '질문을 찾을 수 없습니다';
                document.getElementById('real-question').textContent = realQuestion;
            }
            
            // 투표 섹션 설정
            setupVotingSection();
        }

        // 투표 섹션 설정
        function setupVotingSection() {
            const votingSection = document.getElementById('voting-section');
            votingSection.innerHTML = '';
            
            for (let i = 0; i < gameState.totalPlayers; i++) {
                const btn = document.createElement('button');
                btn.className = 'player-btn';
                btn.textContent = gameState.isHost && i === 0 ? '호스트' : `플레이어 ${i + 1}`;
                btn.onclick = () => {
                    document.querySelectorAll('#voting-section .player-btn').forEach(b => 
                        b.classList.remove('selected'));
                    btn.classList.add('selected');
                    
                    // 투표 처리 (실제로는 각 플레이어의 핸드폰에서 개별적으로 처리)
                    alert(`${btn.textContent}에게 투표했습니다!`);
                };
                votingSection.appendChild(btn);
            }
        }

        // 점수 관리 설정 (호스트용)
        function setupScoreManagement() {
            const container = document.getElementById('score-management');
            container.innerHTML = '';
            
            Object.keys(gameState.scores).forEach(player => {
                const scoreDiv = document.createElement('div');
                scoreDiv.className = 'score-counter';
                scoreDiv.innerHTML = `
                    <span>${player}</span>
                    <div>
                        <button class="counter-btn minus" onclick="changeScore('${player}', -1)">-</button>
                        <span id="score-${player}">${gameState.scores[player]}</span>
                        <button class="counter-btn plus" onclick="changeScore('${player}', 1)">+</button>
                    </div>
                `;
                container.appendChild(scoreDiv);
            });
        }

        // 점수 변경
        function changeScore(player, delta) {
            gameState.scores[player] = Math.max(0, gameState.scores[player] + delta);
            document.getElementById(`score-${player}`).textContent = gameState.scores[player];
        }

        // 페이커 포기
        function fakerGiveUp() {
            alert('페이커가 포기했습니다!');
            document.querySelector('#host-controls .btn-success').classList.remove('hidden');
            document.querySelector('#player-controls .btn-success')?.classList.remove('hidden');
        }

        // 페이커 공개
        function revealFaker() {
            const btn = document.getElementById('reveal-faker-btn');
            if (btn.textContent === '페이커 공개') {
                btn.textContent = '정말로 공개하나요?';
                btn.className = 'btn btn-danger';
            } else {
                alert(`페이커는 ${gameState.isFaker ? '당신' : '다른 플레이어'}입니다!`);
                btn.textContent = '페이커 공개';
                btn.className = 'btn btn-secondary';
            }
        }

        // 다음 라운드
        function nextRound() {
            if (gameState.currentRound >= 4) {
                alert('게임이 끝났습니다! 최종 점수를 확인하세요.');
                showFinalScores();
                return;
            }
            
            gameState.currentRound++;
            
            // 페이지 초기화
            document.getElementById('answer-section').classList.remove('hidden');
            document.getElementById('submit-answer').classList.remove('hidden');
            document.getElementById('after-submit').classList.add('hidden');
            document.getElementById('reveal-section').classList.add('hidden');
            document.getElementById('faker-hint').classList.add('hidden');
            
            // 입력 초기화
            document.getElementById('answer-input').value = '';
            gameState.currentAnswer = '';
            
            // 새 질문 로드
            loadCurrentQuestion();
            updateGameHeader();
        }

        // 최종 점수 표시
        function showFinalScores() {
            let scoreText = '🏆 최종 점수 🏆\n\n';
            Object.entries(gameState.scores)
                .sort(([,a], [,b]) => b - a)
                .forEach(([player, score], index) => {
                    const medal = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : '🏅';
                    scoreText += `${medal} ${player}: ${score}점\n`;
                });
            
            alert(scoreText);
        }

        // 게임 헤더 업데이트
        function updateGameHeader() {
            document.getElementById('game-header').textContent = `라운드 ${gameState.currentRound}`;
        }

        // 역할 표시 업데이트
        function updateRoleDisplay() {
            const roleDisplay = document.getElementById('role-display');
            if (gameState.isFaker) {
                roleDisplay.textContent = '🎭 당신은 페이커입니다!';
                roleDisplay.style.color = '#ff6b6b';
            } else {
                roleDisplay.textContent = '🕵️ 페이커를 찾아보세요!';
                roleDisplay.style.color = '#51cf66';
            }
        }

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // 터치 스크롤 방지 (캔버스 영역에서)
            document.addEventListener('touchmove', function(e) {
                if (e.target.tagName === 'CANVAS') {
                    e.preventDefault();
                }
            }, { passive: false });
        });
    </script>
</body>
</html>