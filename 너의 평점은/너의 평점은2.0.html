<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ì˜ í‰ì ì€? - ì†Œì…œ íŒŒí‹° ê²Œì„</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: white;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.1em;
            margin-bottom: 30px;
            opacity: 0.9;
            font-weight: 300;
        }

        .role-selection {
            margin-bottom: 20px;
        }

        .role-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            width: 100%;
            font-weight: 400;
        }

        .role-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .input-group {
            margin: 20px 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 400;
        }

        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-family: 'Roboto', monospace;
            font-weight: 400;
            letter-spacing: 1px;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            width: 100%;
            font-weight: 400;
        }

        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #ff6b6b;
        }

        .btn-secondary:hover {
            background: #ff5252;
        }

        .btn-warning {
            background: #ff9800;
        }

        .btn-warning:hover {
            background: #f57c00;
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-info {
            background: #2196F3;
        }

        .btn-info:hover {
            background: #1976D2;
        }

        .btn-success {
            background: #4CAF50;
        }

        .btn-confirm {
            background: #ff5722;
            animation: pulse 1s infinite;
        }

        .btn-confirm:hover {
            background: #e64a19;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
            margin: 5px;
            width: auto;
            min-width: 40px;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes numberChange {
            0% { 
                transform: scale(1) rotateY(0deg);
                opacity: 1;
            }
            50% { 
                transform: scale(1.2) rotateY(180deg);
                opacity: 0.7;
            }
            100% { 
                transform: scale(1) rotateY(360deg);
                opacity: 1;
            }
        }

        @keyframes sparkle {
            0%, 100% { 
                opacity: 0;
                transform: scale(0);
            }
            50% { 
                opacity: 1;
                transform: scale(1);
            }
        }

        .number-changing {
            animation: numberChange 0.8s ease-in-out;
        }

        .sparkle-effect {
            position: relative;
        }

        .sparkle-effect::before,
        .sparkle-effect::after {
            content: "âœ¨";
            position: absolute;
            font-size: 0.8em;
            animation: sparkle 1s ease-in-out;
        }

        .sparkle-effect::before {
            top: -10px;
            left: -20px;
            animation-delay: 0.2s;
        }

        .sparkle-effect::after {
            top: -10px;
            right: -20px;
            animation-delay: 0.4s;
        }

        .qr-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .qr-code-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            display: inline-block;
        }

        .qr-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .qr-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            color: #333;
        }

        .token {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
            margin: 15px 0;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 12px;
            font-family: 'Roboto', monospace;
            letter-spacing: 4px;
        }

        .game-status {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #FFD700;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .round-info {
            font-size: 1.5em;
            font-weight: 700;
            color: #FFD700;
            margin-bottom: 15px;
        }

        .round-controls {
            margin-top: 15px;
        }

        .scoreboard {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .score-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .score-display {
            font-size: 1.2em;
            font-weight: 700;
            color: #FFD700;
            min-width: 30px;
        }

        .player-name {
            font-weight: 700;
            color: white;
        }

        .current-turn {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #FFD700;
        }

        .host-number {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #FFD700;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .host-secret {
            font-size: 3em;
            font-weight: 700;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .rules {
            text-align: left;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .rules h3 {
            color: #FFD700;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .rules ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .rules li {
            margin: 8px 0;
            line-height: 1.4;
            font-weight: 300;
        }

        .example-box {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #FFD700;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: left;
        }

        .secret-number {
            font-size: 4em;
            font-weight: 700;
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            margin: 30px 0;
            padding: 20px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 20px;
            border: 3px solid #FFD700;
            transition: all 0.3s ease;
        }

        .player-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 400;
        }

        .player-number {
            font-size: 1.5em;
            font-weight: 700;
            color: #FFD700;
            margin-bottom: 10px;
        }

        .subject-generator {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .current-subject {
            font-size: 1.5em;
            font-weight: 700;
            color: #FFD700;
            margin: 15px 0;
            padding: 20px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            border: 2px solid #FFD700;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .reveal-section {
            background: rgba(255, 69, 58, 0.1);
            border: 2px solid #FF453A;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .reveal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .reveal-round-info {
            font-size: 1.1em;
            font-weight: 700;
            color: #FFD700;
        }

        .revealed-numbers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .revealed-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 8px;
            font-weight: 400;
        }

        .revealed-item .player-name {
            font-weight: 700;
            color: #FFD700;
            margin-bottom: 5px;
        }

        .revealed-item .secret-num {
            font-size: 1.5em;
            font-weight: 700;
            color: #4CAF50;
        }

        .warning-text {
            color: #FFC107;
            font-weight: 700;
            margin: 10px 0;
        }

        .hidden {
            display: none;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 50%;
            font-size: 1.2em;
            cursor: pointer;
            width: 50px;
            height: 50px;
            font-weight: 400;
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin: 10px;
                max-width: 95%;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .qr-grid {
                grid-template-columns: 1fr;
            }

            .score-item {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn hidden" id="backBtn" onclick="goBack()">â†</button>
    
    <div class="container">
        <!-- ì‹œì‘ í™”ë©´ -->
        <div id="welcomeScreen">
            <h1>ğŸ² ë‚˜ì˜ í‰ì ì€?</h1>
            <p class="subtitle">ìµœê³ ì˜ ì†Œì…œ íŒŒí‹° ê²Œì„</p>
            
            <div class="role-selection">
                <button class="role-btn" onclick="selectRole('host')">
                    ğŸ¯ ë‚˜ëŠ” í˜¸ìŠ¤íŠ¸
                </button>
                <button class="role-btn" onclick="selectRole('player')">
                    ğŸ® ë‚˜ëŠ” í”Œë ˆì´ì–´
                </button>
            </div>
        </div>

        <!-- í˜¸ìŠ¤íŠ¸ ì„¤ì • í™”ë©´ -->
        <div id="hostScreen" class="hidden">
            <h2>ğŸ¯ í˜¸ìŠ¤íŠ¸ ì„¤ì •</h2>
            <div class="input-group">
                <label for="playerCount">ë‹¤ë¥¸ í”Œë ˆì´ì–´ ìˆ˜ (í˜¸ìŠ¤íŠ¸ ì œì™¸):</label>
                <input type="number" id="playerCount" min="1" max="50" value="3">
                <small>ì›í•˜ëŠ” ë§Œí¼ ë§ì€ í”Œë ˆì´ì–´ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”!</small>
            </div>
            <button class="btn" onclick="generateCodes()">í”Œë ˆì´ì–´ ì½”ë“œ ìƒì„±</button>
        </div>

        <!-- í˜¸ìŠ¤íŠ¸ ì½”ë“œ í‘œì‹œ í™”ë©´ -->
        <div id="hostCodesScreen" class="hidden">
            <h2>ğŸ¯ í”Œë ˆì´ì–´ ì½”ë“œ ìƒì„± ì™„ë£Œ</h2>
            <p>ì´ ì½”ë“œë“¤ì„ í”Œë ˆì´ì–´ë“¤ì—ê²Œ ë‚˜ëˆ„ì–´ ì£¼ì„¸ìš”:</p>
            <div id="codesContainer"></div>
            
            <!-- QR ì½”ë“œ ì„¹ì…˜ -->
            <div class="qr-section">
                <h3>ğŸ“± QR ì½”ë“œë¡œ ë¹ ë¥¸ ì…ì¥</h3>
                <p>í”Œë ˆì´ì–´ë“¤ì´ ìŠ¤ìº”í•´ì„œ ì…ì¥í•  ìˆ˜ ìˆì–´ìš”:</p>
                <button class="btn btn-info" onclick="toggleQRCode()">
                    <span id="qrToggleText">QR ì½”ë“œ ë³´ê¸°</span>
                </button>
                <div class="qr-code-container hidden" id="qrCodeContainer">
                    <canvas id="qrCanvas"></canvas>
                </div>
            </div>
            
            <button class="btn btn-success" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
            <button class="btn btn-secondary" onclick="goBack()">ì„¤ì •ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- í˜¸ìŠ¤íŠ¸ ë©”ì¸ ê²Œì„ í™”ë©´ -->
        <div id="hostGameScreen" class="hidden">
            <h2>ğŸ¯ í˜¸ìŠ¤íŠ¸ ê²Œì„ ì»¨íŠ¸ë¡¤</h2>
            
            <!-- ê²Œì„ ìƒíƒœ -->
            <div class="game-status">
                <div class="round-info"><span id="currentRound">1</span>ë¼ìš´ë“œ</div>
                <div class="round-controls">
                    <button class="btn btn-info" id="nextRoundBtn" onclick="confirmNextRound()">
                        ë‹¤ìŒ ë¼ìš´ë“œ
                    </button>
                </div>
            </div>

            <!-- ì£¼ì œ ìƒì„±ê¸° -->
            <div class="subject-generator">
                <h3>ğŸ² <span id="categoryPlayerName">í”Œë ˆì´ì–´ 1</span>ì„ ìœ„í•œ ì¹´í…Œê³ ë¦¬</h3>
                <div class="current-subject" id="currentSubject">ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¹´í…Œê³ ë¦¬ë¥¼ ìƒì„±í•˜ì„¸ìš”!</div>
                <button class="btn btn-info" onclick="generateRandomSubject()">ìƒˆ ì¹´í…Œê³ ë¦¬ ìƒì„±</button>
            </div>

            <!-- í˜¸ìŠ¤íŠ¸ ë²ˆí˜¸ í‘œì‹œ -->
            <div class="host-number hidden" id="hostNumberDisplay">
                <h3>ğŸ¤« ë‹¹ì‹ ì˜ ë¹„ë°€ ë²ˆí˜¸ (<span id="hostRoundDisplay">1</span>ë¼ìš´ë“œ)</h3>
                <div class="host-secret" id="hostSecret">?</div>
                <button class="btn btn-warning" onclick="hideHostNumber()">ë²ˆí˜¸ ìˆ¨ê¸°ê¸°</button>
            </div>
            <button class="btn btn-warning" id="hostRevealBtn" onclick="confirmHostReveal()">
                ì´ë²ˆ ë¼ìš´ë“œ ë‚´ ë²ˆí˜¸ ë³´ê¸°
            </button>

            <!-- ì ìˆ˜íŒ -->
            <div class="scoreboard">
                <h3>ğŸ† ì ìˆ˜íŒ</h3>
                <div id="scoreboardContainer"></div>
            </div>

            <!-- ê²Œì„ ì»¨íŠ¸ë¡¤ -->
            <div class="game-controls">
                <button class="btn btn-success" onclick="nextTurn()">ë‹¤ìŒ í”Œë ˆì´ì–´ ì°¨ë¡€</button>
            </div>

            <!-- ê¸´ê¸‰ ê³µê°œ -->
            <div class="reveal-section">
                <div class="reveal-header">
                    <div>
                        <h3>ğŸ” ê¸´ê¸‰ ê³µê°œ</h3>
                        <p class="warning-text">âš ï¸ í•„ìš”í•  ë•Œë§Œ ì‚¬ìš©í•˜ì„¸ìš”!</p>
                    </div>
                    <div class="reveal-round-info"><span id="revealRoundDisplay">1</span>ë¼ìš´ë“œ</div>
                </div>
                
                <button class="btn btn-danger" id="playersRevealBtn" onclick="confirmPlayersReveal()">
                    ëª¨ë“  ë²ˆí˜¸ ê³µê°œ (í˜„ì¬ ë¼ìš´ë“œ)
                </button>
                
                <div id="revealedNumbers" class="revealed-numbers hidden"></div>
                
                <button class="btn btn-secondary hidden" id="hideRevealBtn" onclick="hideRevealedNumbers()">
                    ê³µê°œëœ ë²ˆí˜¸ ìˆ¨ê¸°ê¸°
                </button>
            </div>
        </div>

        <!-- í”Œë ˆì´ì–´ ì…ì¥ í™”ë©´ -->
        <div id="playerScreen" class="hidden">
            <h2>ğŸ® í”Œë ˆì´ì–´ ì…ì¥</h2>
            <div class="input-group">
                <label for="playerToken">4ê¸€ì ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”:</label>
                <input type="text" id="playerToken" placeholder="ì˜ˆ: ABCD" style="text-transform: uppercase;" maxlength="4">
            </div>
            <button class="btn" onclick="validateToken()">ê²Œì„ ì°¸ì—¬</button>
        </div>

        <!-- í”Œë ˆì´ì–´ ê²Œì„ í™”ë©´ -->
        <div id="playerGameScreen" class="hidden">
            <h2>ğŸ® <span id="playerTitle">í”Œë ˆì´ì–´ #</span></h2>
            
            <div class="game-status">
                <div class="round-info"><span id="playerCurrentRound">1</span>ë¼ìš´ë“œ</div>
            </div>

            <div class="player-info">
                <div class="player-number">ì´ë²ˆ ë¼ìš´ë“œ ë‹¹ì‹ ì˜ ë²ˆí˜¸</div>
                <div class="secret-number" id="playerSecretNumber">?</div>
                <p>ë‹¹ì‹ ì˜ ì°¨ë¡€ê°€ ë˜ë©´, ë°œí‘œëœ ì¹´í…Œê³ ë¦¬ì—ì„œ ì´ ë²ˆí˜¸ë§Œí¼ í‰ì ì„ ì¤„ ë§Œí•œ ê²ƒì„ ë§í•˜ì„¸ìš”!</p>
            </div>

            <div class="rules">
                <h3>ğŸ¯ ì ìˆ˜ ê·œì¹™</h3>
                <ul>
                    <li>ë‹¤ë¥¸ ì‚¬ëŒì´ ë‹¹ì‹ ì˜ ë²ˆí˜¸ë¥¼ ë§íˆë©´: <strong>ë§íŒ ì‚¬ëŒ ìˆ˜ë§Œí¼ +1ì </strong></li>
                    <li>ë‹¹ì‹ ì´ ë‹¤ë¥¸ ì‚¬ëŒì˜ ë²ˆí˜¸ë¥¼ ë§íˆë©´: <strong>+1ì </strong></li>
                    <li><strong>ë‹¨,</strong> ëª¨ë“  ì‚¬ëŒì´ ë‹¹ì‹ ì˜ ë²ˆí˜¸ë¥¼ ë§íˆë©´ ë‹¹ì‹ ì€ 0ì  (ë„ˆë¬´ ë»”í•˜ë©´ ì•ˆ ë¼ìš”!)</li>
                </ul>
            </div>

            <button class="btn btn-info" id="playerNextRoundBtn" onclick="confirmPlayerNextRound()">ë‹¤ìŒ ë¼ìš´ë“œ</button>
        </div>

        <!-- ê²Œì„ ê·œì¹™ í™”ë©´ -->
        <div id="rulesScreen" class="hidden">
            <h2>ğŸ“‹ ê²Œì„ ë°©ë²•</h2>
            
            <div class="player-info">
                <div class="player-number" id="playerNumberDisplay">ë‹¹ì‹ ì€ í”Œë ˆì´ì–´ #</div>
                <p>í”Œë ˆì´ì–´ ë²ˆí˜¸ë¥¼ ê¸°ì–µí•˜ì„¸ìš”!</p>
            </div>
            
            <div class="rules">
                <h3>ğŸ¯ ëª©í‘œ</h3>
                <p>ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ì˜ ë‹µë³€ì„ ë“£ê³  ê·¸ë“¤ì˜ ë¹„ë°€ ë²ˆí˜¸ë¥¼ ë§ì¶°ë³´ì„¸ìš”!</p>
                
                <h3>ğŸ® ê²Œì„ ì§„í–‰</h3>
                <ul>
                    <li>ë§¤ ë¼ìš´ë“œë§ˆë‹¤ ëª¨ë“  ì‚¬ëŒì´ 1-10 ì‚¬ì´ì˜ ë¹„ë°€ ë²ˆí˜¸ë¥¼ ë°›ì•„ìš”</li>
                    <li>í”Œë ˆì´ì–´ë“¤ì´ ìˆœì„œëŒ€ë¡œ ì§„í–‰í•´ìš” (í”Œë ˆì´ì–´ 1, 2, 3... ê·¸ë‹¤ìŒ í˜¸ìŠ¤íŠ¸)</li>
                    <li>í˜¸ìŠ¤íŠ¸ê°€ í˜„ì¬ í”Œë ˆì´ì–´ë¥¼ ìœ„í•œ ì¹´í…Œê³ ë¦¬ë¥¼ ë°œí‘œí•´ìš”</li>
                    <li><strong>í˜„ì¬ í”Œë ˆì´ì–´ëŠ” ìì‹ ì˜ ë¹„ë°€ ë²ˆí˜¸ë§Œí¼ í‰ì ì„ ì¤„ ë§Œí•œ ê²ƒì„ ë§í•´ìš”</strong></li>
                    <li>ë‹¤ë¥¸ ëª¨ë“  ì‚¬ëŒë“¤ì´ ê·¸ í”Œë ˆì´ì–´ì˜ ë¹„ë°€ ë²ˆí˜¸ë¥¼ ì¶”ì¸¡í•´ìš”</li>
                    <li>ë§íŒ ì •ë„ì— ë”°ë¼ ì ìˆ˜ë¥¼ ë°›ì•„ìš”</li>
                </ul>
                
                <h3>ğŸ† ì ìˆ˜ ê³„ì‚°</h3>
                <ul>
                    <li><strong>ì •ë‹µ ë§íˆê¸°:</strong> +1ì </li>
                    <li><strong>ëˆ„êµ°ê°€ ë‹¹ì‹ ì˜ ë²ˆí˜¸ë¥¼ ë§íˆê¸°:</strong> ë§íŒ ì‚¬ëŒ ìˆ˜ë§Œí¼ +1ì </li>
                    <li><strong>ë‹¨, ëª¨ë“  ì‚¬ëŒì´ ë§íˆë©´:</strong> ë‹¹ì‹ ì€ 0ì  (ë„ˆë¬´ ë»”í•œ ë‹µë³€ ë°©ì§€)</li>
                </ul>
                
                <div class="example-box">
                    <h3>ğŸ’¡ ì˜ˆì‹œ ë¼ìš´ë“œ</h3>
                    <p><strong>ì¹´í…Œê³ ë¦¬: "ì˜í™”" - í”Œë ˆì´ì–´ Aì˜ ì°¨ë¡€ (ë¹„ë°€ë²ˆí˜¸: 7)</strong></p>
                    <p><strong>í”Œë ˆì´ì–´ Aê°€ ë§í•¨:</strong> "ìŠ¤íŒŒì´ë”ë§¨" (ìì‹ ì´ 7/10ì  ì¤„ ë§Œí•œ ì˜í™”)</p>
                    <p><strong>ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ ì¶”ì¸¡:</strong> í”Œë ˆì´ì–´ BëŠ” 8, í”Œë ˆì´ì–´ CëŠ” 7, í˜¸ìŠ¤íŠ¸ëŠ” 6ìœ¼ë¡œ ì¶”ì¸¡</p>
                    <p><strong>ê²°ê³¼:</strong> í”Œë ˆì´ì–´ Cê°€ +1ì , í”Œë ˆì´ì–´ Aê°€ +1ì  (í”Œë ˆì´ì–´ Cê°€ ë§í˜”ìœ¼ë¯€ë¡œ)</p>
                </div>
            </div>
            <button class="btn" onclick="enterGame()">ê²Œì„ ì‹œì‘!</button>
        </div>
    </div>

    <!-- QR ì½”ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

    <script>
        let currentScreen = 'welcome';
        let playerTokens = {};
        let currentPlayerNumber = null;
        let currentPlayerToken = null;
        let hostSecretNumbers = []; // ëª¨ë“  ë¼ìš´ë“œìš© ë°°ì—´
        let hostRevealState = 'initial';
        let playersRevealState = 'initial';
        let nextRoundState = 'initial';
        let playerNextRoundState = 'initial';
        let playerCurrentRound = 1; // ë…ë¦½ì ì¸ í”Œë ˆì´ì–´ ë¼ìš´ë“œ ì¹´ìš´í„°
        let gameState = {
            currentRound: 1,
            currentTurn: 1, // 1 = í”Œë ˆì´ì–´ 1, 2 = í”Œë ˆì´ì–´ 2, ë“±ë“±, 0 = í˜¸ìŠ¤íŠ¸
            maxPlayers: 0,
            scores: {},
            maxRounds: 10
        };

        // ì‚¬ìš© ê°€ëŠ¥í•œ ê¸€ìë“¤ (Iì™€ L ì œì™¸)
        const AVAILABLE_LETTERS = 'ABCDEFGHJKMNOPQRSTUVWXYZ'; // 24ê¸€ì

        // ì¹´í…Œê³ ë¦¬ ëª©ë¡
        const categories = [
            "ì˜í™”", "ë“œë¼ë§ˆ", "ë…¸ë˜", "ê²Œì„", "ì±…", "ë°°ìš°/ì—¬ë°°ìš°", "ê°€ìˆ˜/ê·¸ë£¹", 
            "ì• ë‹ˆë©”ì´ì…˜", "ìœ íŠœë²„", "íŒŸìºìŠ¤íŠ¸", "ìŒì‹", "ë””ì €íŠ¸", "í”¼ì í† í•‘", "ìŒë£Œ", "ì‹ë‹¹", 
            "ì•„ì´ìŠ¤í¬ë¦¼ ë§›", "ì•„ì¹¨ì‹ì‚¬", "ê°„ì‹", "íŒ¨ìŠ¤íŠ¸í‘¸ë“œ", "ìš”ë¦¬", "ìŠ¤í¬ì¸ ", 
            "ì·¨ë¯¸", "ìš´ë™", "íŒŒí‹°ê²Œì„", "ì£¼ë§í™œë™", "ì—¬í–‰ì§€", 
            "ë³´ë“œê²Œì„", "ì•¼ì™¸í™œë™", "ì˜ˆìˆ ", "ì¶¤", "í•™êµê³¼ëª©", "ì§ì—…", 
            "ë™ë¬¼", "ìƒ‰ê¹”", "ê³„ì ˆ", "ë‚ ì”¨", "êµí†µìˆ˜ë‹¨", "ì•±", "SNS", 
            "ì˜ë¥˜ë¸Œëœë“œ", "ì´ˆëŠ¥ë ¥", "ë””ì¦ˆë‹ˆ ìºë¦­í„°", "ìë™ì°¨ ë¸Œëœë“œ", "ë‚˜ë¼", "ì—°ì˜ˆì¸", 
            "íŒ¨ì…˜ íŠ¸ë Œë“œ", "ë°© ì¸í…Œë¦¬ì–´", "ê³µë¶€ë°©ë²•", "ì•„ì¹¨ë£¨í‹´", "ê°ì •"
        ];

        /**
         * ìŠ¤ë§ˆíŠ¸ ì•Œê³ ë¦¬ì¦˜: 4ê¸€ì ì½”ë“œë¥¼ ì‹œë“œë¡œ ë³€í™˜í•˜ì—¬ ê²°ì •ì  ëœë¤ ë²ˆí˜¸ ìƒì„±
         */
        
        function generateSimpleToken() {
            // 4ê°œì˜ ëœë¤ ê¸€ìë§Œ ìƒì„±
            let code = '';
            for (let i = 0; i < 4; i++) {
                code += AVAILABLE_LETTERS[Math.floor(Math.random() * AVAILABLE_LETTERS.length)];
            }
            return code;
        }

        function codeToSeed(fourLetterCode) {
            // 4ê¸€ì ì½”ë“œë¥¼ 24ì§„ë²• ìˆ«ìë¡œ ë³€í™˜í•˜ì—¬ ì‹œë“œë¡œ ì‚¬ìš©
            let seed = 0;
            for (let i = 0; i < fourLetterCode.length; i++) {
                const letterIndex = AVAILABLE_LETTERS.indexOf(fourLetterCode[i]);
                seed = seed * 24 + letterIndex;
            }
            // ì‹œë“œê°€ ì–‘ìˆ˜ì´ê³  ì ì ˆí•˜ë„ë¡ ë³´ì¥
            return Math.abs(seed) + 1;
        }

        function seedRandom(seed) {
            // ê²°ì •ì  ëœë¤ ë²ˆí˜¸ë¥¼ ìœ„í•œ ê°„ë‹¨í•œ ì„ í˜• í•©ë™ ìƒì„±ê¸°
            let state = seed;
            return function() {
                state = (state * 1664525 + 1013904223) % Math.pow(2, 32);
                return (state / Math.pow(2, 32));
            };
        }

        function generateSecretNumbers(fourLetterCode, maxRounds) {
            const seed = codeToSeed(fourLetterCode);
            const rng = seedRandom(seed);
            
            const secretNumbers = [];
            for (let i = 0; i < maxRounds; i++) {
                // 1-10 ì‚¬ì´ ë²ˆí˜¸ ìƒì„±
                const number = Math.floor(rng() * 10) + 1;
                secretNumbers.push(number);
            }
            return secretNumbers;
        }

        function decodeToken(token) {
            if (!token || token.length !== 4) {
                return null;
            }
            
            // ëª¨ë“  ê¸€ìê°€ ìœ íš¨í•œì§€ í™•ì¸
            for (let letter of token) {
                if (!AVAILABLE_LETTERS.includes(letter)) {
                    return null;
                }
            }
            
            return generateSecretNumbers(token, gameState.maxRounds);
        }

        function selectRole(role) {
            currentScreen = role;
            hideAllScreens();
            
            if (role === 'host') {
                document.getElementById('hostScreen').classList.remove('hidden');
            } else {
                document.getElementById('playerScreen').classList.remove('hidden');
            }
            
            showBackButton();
        }

        function generateCodes() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            
            if (playerCount < 1 || playerCount > 50) {
                alert('1ëª…ì—ì„œ 50ëª… ì‚¬ì´ì˜ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            playerTokens = {};
            gameState.maxPlayers = playerCount;
            gameState.scores = { 'í˜¸ìŠ¤íŠ¸': 0 };

            // ëœë¤ 4ê¸€ì ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ í˜¸ìŠ¤íŠ¸ ë¹„ë°€ ë²ˆí˜¸ ìƒì„±
            const hostCode = Array.from({length: 4}, () => 
                AVAILABLE_LETTERS[Math.floor(Math.random() * AVAILABLE_LETTERS.length)]
            ).join('');
            hostSecretNumbers = generateSecretNumbers(hostCode, gameState.maxRounds);

            // ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ì„ ìœ„í•œ í† í° ìƒì„±
            for (let i = 1; i <= playerCount; i++) {
                const token = generateSimpleToken();
                const secretNumbers = generateSecretNumbers(token, gameState.maxRounds);
                
                playerTokens[token] = {
                    playerNumber: i,
                    secretNumbers: secretNumbers
                };
                
                gameState.scores[`í”Œë ˆì´ì–´ ${i}`] = 0;
            }

            showCodesScreen();
        }

        function showCodesScreen() {
            const codesContainer = document.getElementById('codesContainer');
            codesContainer.innerHTML = '';

            // 4ê¸€ìë§Œìœ¼ë¡œ ëª¨ë“  í”Œë ˆì´ì–´ ì½”ë“œ í‘œì‹œ
            for (const [token, data] of Object.entries(playerTokens)) {
                const codeItem = document.createElement('div');
                codeItem.className = 'qr-item';
                codeItem.innerHTML = `
                    <h3>í”Œë ˆì´ì–´ ${data.playerNumber}</h3>
                    <div class="token">${token}</div>
                    <small>ì´ ì½”ë“œë¥¼ í”Œë ˆì´ì–´ ${data.playerNumber}ì—ê²Œ ì£¼ì„¸ìš”</small>
                `;
                codesContainer.appendChild(codeItem);
            }

            generateQRCode();
            
            hideAllScreens();
            document.getElementById('hostCodesScreen').classList.remove('hidden');
            currentScreen = 'hostCodes';
        }

        function startGame() {
            hideAllScreens();
            document.getElementById('hostGameScreen').classList.remove('hidden');
            currentScreen = 'hostGame';
            
            updateGameDisplay();
            updateScoreboard();
        }

        function updateGameDisplay() {
            document.getElementById('currentRound').textContent = gameState.currentRound;
            document.getElementById('hostRoundDisplay').textContent = gameState.currentRound;
            document.getElementById('revealRoundDisplay').textContent = gameState.currentRound;
            
            const currentPlayerName = gameState.currentTurn === 0 ? 'í˜¸ìŠ¤íŠ¸' : `í”Œë ˆì´ì–´ ${gameState.currentTurn}`;
            document.getElementById('categoryPlayerName').textContent = currentPlayerName;
            
            // í˜¸ìŠ¤íŠ¸ì˜ í˜„ì¬ ë²ˆí˜¸ ì—…ë°ì´íŠ¸
            document.getElementById('hostSecret').textContent = hostSecretNumbers[gameState.currentRound - 1];
            
            resetHostRevealButton();
            resetNextRoundButton();
        }

        function generateQRCode() {
            const currentURL = window.location.href;
            const canvas = document.getElementById('qrCanvas');
            
            if (typeof QRCode !== 'undefined') {
                QRCode.toCanvas(canvas, currentURL, { width: 200 }, function (error) {
                    if (error) console.error('QR ì½”ë“œ ìƒì„± ì‹¤íŒ¨:', error);
                });
            } else {
                // QR ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´
                const ctx = canvas.getContext('2d');
                canvas.width = 200;
                canvas.height = 200;
                ctx.fillStyle = '#333';
                ctx.fillRect(0, 0, 200, 200);
                ctx.fillStyle = 'white';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('QR ì½”ë“œ', 100, 90);
                ctx.fillText('ë¡œë“œ ì‹¤íŒ¨', 100, 110);
                ctx.fillText('URL ìˆ˜ë™ ê³µìœ ', 100, 130);
            }
        }

        function toggleQRCode() {
            const container = document.getElementById('qrCodeContainer');
            const toggleText = document.getElementById('qrToggleText');
            
            if (container.classList.contains('hidden')) {
                container.classList.remove('hidden');
                toggleText.textContent = 'QR ì½”ë“œ ìˆ¨ê¸°ê¸°';
            } else {
                container.classList.add('hidden');
                toggleText.textContent = 'QR ì½”ë“œ ë³´ê¸°';
            }
        }

        function updateScoreboard() {
            const container = document.getElementById('scoreboardContainer');
            container.innerHTML = '';
            
            for (const [playerName, score] of Object.entries(gameState.scores)) {
                const scoreItem = document.createElement('div');
                scoreItem.className = 'score-item';
                
                const currentPlayerName = gameState.currentTurn === 0 ? 'í˜¸ìŠ¤íŠ¸' : `í”Œë ˆì´ì–´ ${gameState.currentTurn}`;
                if (playerName === currentPlayerName) {
                    scoreItem.classList.add('current-turn');
                }
                
                scoreItem.innerHTML = `
                    <div class="player-name">${playerName}</div>
                    <div class="score-controls">
                        <button class="btn btn-secondary btn-small" onclick="adjustScore('${playerName}', -1)">-</button>
                        <div class="score-display">${score}</div>
                        <button class="btn btn-success btn-small" onclick="adjustScore('${playerName}', 1)">+</button>
                    </div>
                `;
                
                container.appendChild(scoreItem);
            }
        }

        function adjustScore(playerName, delta) {
            gameState.scores[playerName] = Math.max(0, gameState.scores[playerName] + delta);
            updateScoreboard();
        }

        function nextTurn() {
            gameState.currentTurn++;
            if (gameState.currentTurn > gameState.maxPlayers) {
                gameState.currentTurn = 0; // í˜¸ìŠ¤íŠ¸ ì°¨ë¡€
            }
            updateGameDisplay();
            updateScoreboard();
            
            // í˜„ì¬ ì£¼ì œ ì§€ìš°ê¸°
            document.getElementById('currentSubject').textContent = 'ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¹´í…Œê³ ë¦¬ë¥¼ ìƒì„±í•˜ì„¸ìš”!';
        }

        function confirmNextRound() {
            const btn = document.getElementById('nextRoundBtn');
            
            if (nextRoundState === 'initial') {
                if (gameState.currentRound >= gameState.maxRounds) {
                    alert(`ìµœëŒ€ ${gameState.maxRounds}ë¼ìš´ë“œê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤!`);
                    return;
                }
                
                nextRoundState = 'confirming';
                btn.textContent = 'ì •ë§ë¡œ í•˜ì‹œê² ì–´ìš”? ë‹¤ì‹œ í´ë¦­';
                btn.className = 'btn btn-confirm';
                
                setTimeout(() => {
                    if (nextRoundState === 'confirming') {
                        resetNextRoundButton();
                    }
                }, 3000);
                
            } else if (nextRoundState === 'confirming') {
                nextRound();
            }
        }

        function resetNextRoundButton() {
            nextRoundState = 'initial';
            const btn = document.getElementById('nextRoundBtn');
            btn.textContent = 'ë‹¤ìŒ ë¼ìš´ë“œ';
            btn.className = 'btn btn-info';
        }

        function nextRound() {
            gameState.currentRound++;
            gameState.currentTurn = 1; // í”Œë ˆì´ì–´ 1ë¶€í„° ì‹œì‘
            updateGameDisplay();
            updateScoreboard();
            
            // í˜„ì¬ ì£¼ì œ ì§€ìš°ê¸°
            document.getElementById('currentSubject').textContent = 'ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¹´í…Œê³ ë¦¬ë¥¼ ìƒì„±í•˜ì„¸ìš”!';
            
            // í˜¸ìŠ¤íŠ¸ ë²ˆí˜¸ ìˆ¨ê¸°ê³  ê³µê°œ ìƒíƒœ ë¦¬ì…‹
            document.getElementById('hostNumberDisplay').classList.add('hidden');
            hostRevealState = 'initial';
            resetHostRevealButton();
            
            // ê³µê°œëœ ë²ˆí˜¸ ìˆ¨ê¸°ê¸°
            hideRevealedNumbers();
            playersRevealState = 'initial';
            resetPlayersRevealButton();
        }

        function confirmHostReveal() {
            const btn = document.getElementById('hostRevealBtn');
            
            if (hostRevealState === 'initial') {
                hostRevealState = 'confirming';
                btn.textContent = 'ì •ë§ë¡œ í•˜ì‹œê² ì–´ìš”? ë‹¤ì‹œ í´ë¦­í•´ì„œ ê³µê°œ';
                btn.className = 'btn btn-confirm';
                
                setTimeout(() => {
                    if (hostRevealState === 'confirming') {
                        resetHostRevealButton();
                    }
                }, 3000);
                
            } else if (hostRevealState === 'confirming') {
                hostRevealState = 'revealed';
                document.getElementById('hostNumberDisplay').classList.remove('hidden');
                btn.textContent = 'ë²ˆí˜¸ ê³µê°œë¨';
                btn.className = 'btn btn-secondary';
                btn.disabled = true;
            }
        }

        function hideHostNumber() {
            document.getElementById('hostNumberDisplay').classList.add('hidden');
            hostRevealState = 'initial';
            resetHostRevealButton();
        }

        function resetHostRevealButton() {
            hostRevealState = 'initial';
            const btn = document.getElementById('hostRevealBtn');
            btn.textContent = 'ì´ë²ˆ ë¼ìš´ë“œ ë‚´ ë²ˆí˜¸ ë³´ê¸°';
            btn.className = 'btn btn-warning';
            btn.disabled = false;
        }

        function confirmPlayersReveal() {
            const btn = document.getElementById('playersRevealBtn');
            
            if (playersRevealState === 'initial') {
                playersRevealState = 'confirming';
                btn.textContent = 'ì •ë§ë¡œ í•˜ì‹œê² ì–´ìš”? ë‹¤ì‹œ í´ë¦­í•´ì„œ ëª¨ë‘ ê³µê°œ';
                btn.className = 'btn btn-confirm';
                
                setTimeout(() => {
                    if (playersRevealState === 'confirming') {
                        resetPlayersRevealButton();
                    }
                }, 3000);
                
            } else if (playersRevealState === 'confirming') {
                playersRevealState = 'revealed';
                revealAllNumbers();
                btn.textContent = 'ëª¨ë“  ë²ˆí˜¸ ê³µê°œë¨';
                btn.className = 'btn btn-secondary';
                btn.disabled = true;
                
                // ìˆ¨ê¸°ê¸° ë²„íŠ¼ ë³´ì´ê¸°
                document.getElementById('hideRevealBtn').classList.remove('hidden');
            }
        }

        function resetPlayersRevealButton() {
            playersRevealState = 'initial';
            const btn = document.getElementById('playersRevealBtn');
            btn.textContent = 'ëª¨ë“  ë²ˆí˜¸ ê³µê°œ (í˜„ì¬ ë¼ìš´ë“œ)';
            btn.className = 'btn btn-danger';
            btn.disabled = false;
        }

        function revealAllNumbers() {
            const revealContainer = document.getElementById('revealedNumbers');
            revealContainer.innerHTML = '';
            
            for (const [token, data] of Object.entries(playerTokens)) {
                const currentNumber = data.secretNumbers[gameState.currentRound - 1];
                const revealItem = document.createElement('div');
                revealItem.className = 'revealed-item';
                revealItem.innerHTML = `
                    <div class="player-name">í”Œë ˆì´ì–´ ${data.playerNumber}</div>
                    <div class="secret-num">${currentNumber}</div>
                    <small>${gameState.currentRound}ë¼ìš´ë“œ</small>
                `;
                revealContainer.appendChild(revealItem);
            }
            
            revealContainer.classList.remove('hidden');
        }

        function hideRevealedNumbers() {
            document.getElementById('revealedNumbers').classList.add('hidden');
            document.getElementById('hideRevealBtn').classList.add('hidden');
            playersRevealState = 'initial';
            resetPlayersRevealButton();
        }

        function validateToken() {
            const token = document.getElementById('playerToken').value.toUpperCase().trim();
            
            if (!token) {
                alert('4ê¸€ì ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (token.length !== 4) {
                alert('ì½”ë“œëŠ” ì •í™•íˆ 4ê¸€ìì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            // í† í°ìœ¼ë¡œ í”Œë ˆì´ì–´ ì°¾ê¸°
            let foundPlayer = null;
            for (const [playerToken, data] of Object.entries(playerTokens)) {
                if (playerToken === token) {
                    foundPlayer = data;
                    break;
                }
            }

            if (foundPlayer) {
                currentPlayerNumber = foundPlayer.playerNumber;
                currentPlayerToken = token;
                showRules();
                return;
            }

            // ëª¨ë“  ê¸€ìê°€ ìœ íš¨í•œì§€ í™•ì¸
            let validCode = true;
            for (let letter of token) {
                if (!AVAILABLE_LETTERS.includes(letter)) {
                    validCode = false;
                    break;
                }
            }
            
            if (validCode) {
                // ë°ëª¨ìš©ìœ¼ë¡œ ê¸°ë³¸ í”Œë ˆì´ì–´ ë²ˆí˜¸ ì‚¬ìš©
                currentPlayerNumber = 1;
                currentPlayerToken = token;
                showRules();
            } else {
                alert('ì½”ë“œì— ì˜ëª»ëœ ê¸€ìê°€ ìˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        function showRules() {
            hideAllScreens();
            document.getElementById('rulesScreen').classList.remove('hidden');
            document.getElementById('playerNumberDisplay').textContent = `ë‹¹ì‹ ì€ í”Œë ˆì´ì–´ ${currentPlayerNumber}`;
        }

        function enterGame() {
            hideAllScreens();
            document.getElementById('playerGameScreen').classList.remove('hidden');
            document.getElementById('playerTitle').textContent = `í”Œë ˆì´ì–´ ${currentPlayerNumber}`;
            playerCurrentRound = 1; // ê²Œì„ ì§„ì… ì‹œ ë¼ìš´ë“œ 1ë¡œ ë¦¬ì…‹
            updatePlayerGameDisplay();
        }

        function updatePlayerGameDisplay() {
            let currentNumber;
            
            if (currentPlayerToken && playerTokens[currentPlayerToken]) {
                currentNumber = playerTokens[currentPlayerToken].secretNumbers[playerCurrentRound - 1];
            } else {
                const decodedNumbers = decodeToken(currentPlayerToken);
                currentNumber = decodedNumbers ? decodedNumbers[playerCurrentRound - 1] : Math.floor(Math.random() * 10) + 1;
            }
            
            document.getElementById('playerSecretNumber').textContent = currentNumber;
            document.getElementById('playerCurrentRound').textContent = playerCurrentRound;
        }

        function animateNumberChange() {
            const numberElement = document.getElementById('playerSecretNumber');
            
            // ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì¶”ê°€
            numberElement.classList.add('number-changing', 'sparkle-effect');
            
            // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ í´ë˜ìŠ¤ ì œê±°
            setTimeout(() => {
                numberElement.classList.remove('number-changing', 'sparkle-effect');
            }, 1000);
        }

        function confirmPlayerNextRound() {
            const btn = document.getElementById('playerNextRoundBtn');
            
            if (playerNextRoundState === 'initial') {
                if (playerCurrentRound >= gameState.maxRounds) {
                    alert(`ìµœëŒ€ ${gameState.maxRounds}ë¼ìš´ë“œê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤!`);
                    return;
                }
                
                playerNextRoundState = 'confirming';
                btn.textContent = 'ì •ë§ë¡œ í•˜ì‹œê² ì–´ìš”? ë‹¤ì‹œ í´ë¦­';
                btn.className = 'btn btn-confirm';
                
                setTimeout(() => {
                    if (playerNextRoundState === 'confirming') {
                        resetPlayerNextRoundButton();
                    }
                }, 3000);
                
            } else if (playerNextRoundState === 'confirming') {
                playerNextRound();
            }
        }

        function resetPlayerNextRoundButton() {
            playerNextRoundState = 'initial';
            const btn = document.getElementById('playerNextRoundBtn');
            btn.textContent = 'ë‹¤ìŒ ë¼ìš´ë“œ';
            btn.className = 'btn btn-info';
        }

        function playerNextRound() {
            // ë…ë¦½ì ìœ¼ë¡œ ë‹¤ìŒ ë¼ìš´ë“œë¡œ ì§„í–‰
            playerCurrentRound++;
            playerNextRoundState = 'initial';
            resetPlayerNextRoundButton();
            
            // ë²ˆí˜¸ ë³€ê²½ ì• ë‹ˆë©”ì´ì…˜
            animateNumberChange();
            
            // ì•Œê³ ë¦¬ì¦˜ì—ì„œ ìƒˆ ë²ˆí˜¸ë¡œ í™”ë©´ ì—…ë°ì´íŠ¸
            setTimeout(() => {
                updatePlayerGameDisplay();
            }, 400); // ì• ë‹ˆë©”ì´ì…˜ê³¼ ë™ê¸°í™”ë¥¼ ìœ„í•œ ì§€ì—°
        }

        function generateRandomSubject() {
            const randomIndex = Math.floor(Math.random() * categories.length);
            const category = categories[randomIndex];
            document.getElementById('currentSubject').textContent = category;
        }

        function hideAllScreens() {
            const screens = ['welcomeScreen', 'hostScreen', 'hostCodesScreen', 'hostGameScreen', 'playerScreen', 'playerGameScreen', 'rulesScreen'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
        }

        function showBackButton() {
            document.getElementById('backBtn').classList.remove('hidden');
        }

        function hideBackButton() {
            document.getElementById('backBtn').classList.add('hidden');
        }

        function goBack() {
            if (currentScreen === 'host' || currentScreen === 'player') {
                hideAllScreens();
                hideBackButton();
                document.getElementById('welcomeScreen').classList.remove('hidden');
                currentScreen = 'welcome';
            } else if (currentScreen === 'hostCodes') {
                hideAllScreens();
                document.getElementById('hostScreen').classList.remove('hidden');
                currentScreen = 'host';
            } else if (currentScreen === 'hostGame') {
                hideAllScreens();
                document.getElementById('hostCodesScreen').classList.remove('hidden');
                currentScreen = 'hostCodes';
            } else if (currentScreen === 'rules') {
                hideAllScreens();
                document.getElementById('playerScreen').classList.remove('hidden');
                currentScreen = 'player';
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('playerCount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') generateCodes();
        });

        document.getElementById('playerToken').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') validateToken();
        });

        // í”Œë ˆì´ì–´ í† í° ì…ë ¥ì„ 4ê¸€ìë¡œë§Œ ìë™ í¬ë§·
        document.getElementById('playerToken').addEventListener('input', function(e) {
            let value = e.target.value.toUpperCase();
            
            // ì˜ëª»ëœ ë¬¸ì ì œê±° - ìœ íš¨í•œ ê¸€ìë§Œ í—ˆìš©
            value = value.replace(/[^ABCDEFGHJKMNOPQRSTUVWXYZ]/g, '');
            
            // 4ê¸€ìë¡œ ì œí•œ
            if (value.length > 4) {
                value = value.substring(0, 4);
            }
            
            e.target.value = value;
        });
    </script>
</body>
</html>
