<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜ì´í¬ì‡ - íŒŒí‹°ê²Œì„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: manipulation;
        }

        .container {
            width: 100%;
            max-width: 400px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 600px;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .back-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
        }

        .page {
            display: none;
            padding: 30px;
            text-align: center;
            min-height: 500px;
        }

        .page.active {
            display: block;
        }

        .btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 18px;
            text-align: center;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            border-color: #667eea;
        }

        .counter {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }

        .counter-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .counter-btn.minus {
            background: #ff6b6b;
            color: white;
        }

        .counter-btn.plus {
            background: #51cf66;
            color: white;
        }

        .counter-value {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            min-width: 60px;
        }

        .invite-code {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px dashed #667eea;
        }

        .code {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            letter-spacing: 8px;
            margin: 10px 0;
        }

        .question-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
            text-align: left;
        }

        .question-type {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 18px;
            color: #333;
            line-height: 1.5;
        }

        .answer-input {
            width: 100%;
            min-height: 100px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 16px;
            resize: vertical;
            outline: none;
            margin: 20px 0;
        }

        .canvas {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            margin: 20px 0;
            cursor: crosshair;
        }

        .voting-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .player-btn {
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .player-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .score-counter {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .hidden {
            display: none !important;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .emoji-btn {
            padding: 10px;
            font-size: 24px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
        }

        .emoji-btn.selected {
            background: #667eea;
            border-color: #667eea;
        }

        @media (max-width: 480px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 15px;
            }
            
            .page {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ì²« í˜ì´ì§€ -->
        <div id="home-page" class="page active">
            <div class="header">
                <h1>ğŸ­ í˜ì´í¬ì‡</h1>
                <p>íŒŒí‹°ê²Œì„ì˜ ìƒˆë¡œìš´ ì°¨ì›</p>
            </div>
            <div style="padding: 30px;">
                <button class="btn btn-primary" onclick="showPage('host-setup')">
                    ğŸ¯ í˜¸ìŠ¤íŠ¸ë¡œ ì‹œì‘í•˜ê¸°
                </button>
                <button class="btn btn-secondary" onclick="showPage('join-game')">
                    ğŸš€ ë°© ì°¸ì—¬í•˜ê¸°
                </button>
            </div>
        </div>

        <!-- í˜¸ìŠ¤íŠ¸ ì„¤ì • í˜ì´ì§€ -->
        <div id="host-setup" class="page">
            <div class="header">
                <button class="back-btn" onclick="showPage('home-page')">â†</button>
                <h2>ê²Œì„ ì„¤ì •</h2>
            </div>
            
            <div class="input-group">
                <label>ì „ì²´ ì¸ì›ìˆ˜</label>
                <div class="counter">
                    <button class="counter-btn minus" onclick="changePlayerCount(-1)">-</button>
                    <span class="counter-value" id="total-players">4</span>
                    <button class="counter-btn plus" onclick="changePlayerCount(1)">+</button>
                </div>
            </div>

            <div class="input-group">
                <label>í˜ì´ì»¤ ì¸ì›ìˆ˜</label>
                <div class="counter">
                    <button class="counter-btn minus" onclick="changeFakerCount(-1)">-</button>
                    <span class="counter-value" id="faker-count">1</span>
                    <button class="counter-btn plus" onclick="changeFakerCount(1)">+</button>
                </div>
            </div>

            <button class="btn btn-success" onclick="generateInviteCodes()">
                ì´ˆëŒ€ì½”ë“œ ìƒì„±í•˜ê¸°
            </button>
        </div>

        <!-- ì´ˆëŒ€ì½”ë“œ í‘œì‹œ í˜ì´ì§€ -->
        <div id="invite-codes" class="page">
            <div class="header">
                <button class="back-btn" onclick="showPage('host-setup')">â†</button>
                <h2>ì´ˆëŒ€ì½”ë“œ</h2>
            </div>
            
            <div id="codes-container"></div>
            
            <button class="btn btn-primary" onclick="startHostGame()">
                ê²Œì„ ì‹œì‘í•˜ê¸°
            </button>
        </div>

        <!-- ë°© ì°¸ì—¬ í˜ì´ì§€ -->
        <div id="join-game" class="page">
            <div class="header">
                <button class="back-btn" onclick="showPage('home-page')">â†</button>
                <h2>ë°© ì°¸ì—¬</h2>
            </div>
            
            <div class="input-group">
                <label>ì´ˆëŒ€ì½”ë“œ ì…ë ¥</label>
                <input type="text" id="invite-code-input" placeholder="4ìë¦¬ ì•ŒíŒŒë²³ ì…ë ¥" 
                       maxlength="4" style="text-transform: uppercase;">
            </div>

            <button class="btn btn-success" onclick="joinGame()">
                ì°¸ì—¬í•˜ê¸°
            </button>
        </div>

        <!-- ê²Œì„ ì§„í–‰ í˜ì´ì§€ -->
        <div id="game-page" class="page">
            <div class="header">
                <h2 id="game-header">ë¼ìš´ë“œ 1</h2>
                <p id="role-display"></p>
            </div>
            
            <div id="question-container">
                <div class="question-box">
                    <div class="question-type" id="question-type">ì…ë ¥í˜• ì§ˆë¬¸</div>
                    <div class="question-text" id="question-text"></div>
                </div>

                <div id="answer-section">
                    <textarea class="answer-input" id="answer-input" placeholder="ì—¬ê¸°ì— ë‹µì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    <canvas id="drawing-canvas" class="canvas hidden" width="350" height="200"></canvas>
                    <div id="emoji-section" class="hidden">
                        <div class="emoji-grid" id="emoji-grid"></div>
                    </div>
                    <div id="player-select" class="hidden">
                        <div class="voting-buttons" id="player-voting"></div>
                    </div>
                </div>

                <button class="btn btn-primary" id="submit-answer" onclick="submitAnswer()">
                    ë‹µë³€ ì œì¶œ
                </button>

                <div id="after-submit" class="hidden">
                    <button class="btn btn-secondary" onclick="revealAnswer()">
                        ë‹µ ê³µê°œ
                    </button>
                </div>

                <div id="reveal-section" class="hidden">
                    <h3>ë‚´ ë‹µë³€</h3>
                    <div id="my-answer" class="question-box"></div>
                    
                    <div id="faker-hint" class="hidden">
                        <h4>ì‹¤ì œ ì§ˆë¬¸:</h4>
                        <div class="question-box">
                            <div class="question-text" id="real-question"></div>
                        </div>
                    </div>

                    <h3>í˜ì´ì»¤ ì°¾ê¸°</h3>
                    <div class="voting-buttons" id="voting-section"></div>
                </div>
            </div>

            <div id="host-controls" class="hidden">
                <h3>ì ìˆ˜ ê´€ë¦¬</h3>
                <div id="score-management"></div>
                
                <button class="btn btn-danger" onclick="fakerGiveUp()">
                    í˜ì´ì»¤ í¬ê¸°
                </button>
                
                <button class="btn btn-secondary" id="reveal-faker-btn" onclick="revealFaker()">
                    í˜ì´ì»¤ ê³µê°œ
                </button>
                
                <button class="btn btn-success hidden" onclick="nextRound()">
                    ë‹¤ìŒ ë¼ìš´ë“œ
                </button>
            </div>

            <div id="player-controls" class="hidden">
                <button class="btn btn-danger" onclick="fakerGiveUp()">
                    í˜ì´ì»¤ í¬ê¸°
                </button>
            </div>
        </div>
    </div>

    <script>
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            totalPlayers: 4,
            fakerCount: 1,
            currentRound: 1,
            isHost: false,
            isFaker: false,
            playerRole: '',
            inviteCodes: [],
            currentAnswer: '',
            questions: [],
            currentQuestionType: 'input',
            scores: {},
            votes: {}
        };

        // ì•ŒíŒŒë²³ ì„¸íŠ¸ ë°ì´í„°
        const alphabetSets = {
            set1: [
                {letters: ['y', 'b', 'g', 'd'], numbers: [19, 29, 27, 7]},
                {letters: ['z', 'a', 'o', 'r'], numbers: [5, 11, 25, 19]},
                {letters: ['x', 'v', 'u', 't'], numbers: [8, 25, 26, 11]},
                {letters: ['q', 'p', 's', 'f'], numbers: [29, 16, 13, 17]},
                {letters: ['c', 'k', 'w', 'e'], numbers: [14, 22, 24, 3]},
                {letters: ['h', 'n', 'm', 'j'], numbers: [11, 6, 30, 10]}
            ],
            set2: [
                {letters: ['r', 'q', 'd', 'k'], numbers: [20, 14, 4, 15]},
                {letters: ['f', 'o', 'n', 'y'], numbers: [27, 9, 28, 6]},
                {letters: ['g', 'z', 'b', 'w'], numbers: [10, 15, 14, 25]},
                {letters: ['e', 't', 'v', 'u'], numbers: [12, 8, 6, 18]},
                {letters: ['a', 'c', 'p', 's'], numbers: [4, 27, 19, 8]},
                {letters: ['x', 'j', 'm', 'h'], numbers: [24, 2, 8, 23]}
            ],
            set3: [
                {letters: ['t', 'b', 'p', 'e'], numbers: [28, 5, 1, 26]},
                {letters: ['a', 'u', 'f', 'x'], numbers: [22, 19, 18, 20]},
                {letters: ['v', 'm', 'r', 'w'], numbers: [3, 20, 17, 13]},
                {letters: ['s', 'n', 'g', 'y'], numbers: [6, 28, 7, 22]},
                {letters: ['k', 'q', 'o', 'h'], numbers: [21, 7, 22, 2]},
                {letters: ['z', 'j', 'c', 'd'], numbers: [26, 3, 2, 9]}
            ],
            set4: [
                {letters: ['f', 'g', 'm', 'q'], numbers: [15, 26, 23, 29]},
                {letters: ['p', 'j', 'v', 'y'], numbers: [23, 17, 29, 21]},
                {letters: ['k', 'r', 'h', 'o'], numbers: [16, 24, 15, 4]},
                {letters: ['z', 'u', 'e', 's'], numbers: [9, 23, 20, 27]},
                {letters: ['t', 'n', 'a', 'w'], numbers: [1, 30, 5, 24]},
                {letters: ['c', 'd', 'x', 'b'], numbers: [7, 13, 21, 16]}
            ]
        };

        // ì§ˆë¬¸ ë°ì´í„°ë² ì´ìŠ¤
        const questionDB = {
            1: {type: 'input', main: 'ìƒì¼ë‚ ì— ë¨¹ê³  ì‹¶ì€ ê²ƒì€?', fake: 'ëŒì”ì¹˜ì—ì„œ ë¨¹ê³  ì‹¶ì€ ê²ƒì€?'},
            2: {type: 'input', main: 'ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ìŒì‹ì€?', fake: 'ê°€ì¥ ì‹«ì–´í•˜ëŠ” ìŒì‹ì€?'},
            3: {type: 'input', main: 'ì—¬í–‰ê°€ê³  ì‹¶ì€ ë‚˜ë¼ëŠ”?', fake: 'ì‚´ê³  ì‹¶ì§€ ì•Šì€ ë‚˜ë¼ëŠ”?'},
            4: {type: 'drawing', main: 'ë¾°ì¡±ì´ë¥¼ ê·¸ë ¤ì£¼ì„¸ìš”', fake: 'ë¶ˆë£©ì´ë¥¼ ê·¸ë ¤ì£¼ì„¸ìš”'},
            5: {type: 'number', main: 'ì´ë²ˆ ë…„ë„ì— ì‹¸ìš´ íšŸìˆ˜ëŠ”?', fake: 'ì´ë²ˆ ë…„ë„ì— ë¹„í–‰ê¸° íƒ„ íšŸìˆ˜ëŠ”?'},
            6: {type: 'emoji', main: 'ìì‹ ì„ í‘œí˜„í•˜ëŠ” ì´ëª¨ì§€ëŠ”?', fake: 'ìì‹ ì´ ìì£¼ ì•ˆ ì“°ëŠ” ì´ëª¨ì§€ëŠ”?'},
            7: {type: 'player', main: 'ê°€ì¥ ì• ì¸ì´ ë§ì•˜ì„ ê²ƒ ê°™ì€ í”Œë ˆì´ì–´ëŠ”?', fake: 'ë‹¬ë¦¬ê¸°ê°€ ê°€ì¥ ë¹ ë¥¼ ê²ƒ ê°™ì€ í”Œë ˆì´ì–´ëŠ”?'},
            8: {type: 'input', main: 'ì–´ë¦´ ë•Œ ì¥ë˜í¬ë§ì€?', fake: 'ë¶€ëª¨ë‹˜ì˜ ì§ì—…ì€?'},
            9: {type: 'input', main: 'ê°€ì¥ ë¬´ì„œì›Œí•˜ëŠ” ê²ƒì€?', fake: 'ê°€ì¥ ìì‹  ìˆëŠ” ê²ƒì€?'},
            10: {type: 'drawing', main: 'ì§‘ì„ ê·¸ë ¤ì£¼ì„¸ìš”', fake: 'ìë™ì°¨ë¥¼ ê·¸ë ¤ì£¼ì„¸ìš”'},
            11: {type: 'number', main: 'í•˜ë£¨ì— ëª‡ ì‹œê°„ ì ì„ ìë‚˜ìš”?', fake: 'í•˜ë£¨ì— ëª‡ ë²ˆ ì›ƒë‚˜ìš”?'},
            12: {type: 'input', main: 'ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ì„ ë¬¼ì€?', fake: 'ê°€ì¥ ë¹„ì‹¼ ì„ ë¬¼ì€?'},
            13: {type: 'input', main: 'ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì„ ë•Œ í•˜ëŠ” ì¼ì€?', fake: 'í–‰ë³µí•  ë•Œ í•˜ëŠ” ì¼ì€?'},
            14: {type: 'input', main: 'ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ê³„ì ˆì€?', fake: 'ê°€ì¥ ì‹«ì–´í•˜ëŠ” ê³„ì ˆì€?'},
            15: {type: 'drawing', main: 'ê°•ì•„ì§€ë¥¼ ê·¸ë ¤ì£¼ì„¸ìš”', fake: 'ê³ ì–‘ì´ë¥¼ ê·¸ë ¤ì£¼ì„¸ìš”'},
            16: {type: 'number', main: 'í•¸ë“œí°ì„ í•˜ë£¨ì— ëª‡ ì‹œê°„ ì‚¬ìš©í•˜ë‚˜ìš”?', fake: 'TVë¥¼ í•˜ë£¨ì— ëª‡ ì‹œê°„ ë³´ë‚˜ìš”?'},
            17: {type: 'input', main: 'ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ìƒ‰ê¹”ì€?', fake: 'ê°€ì¥ ì‹«ì–´í•˜ëŠ” ìƒ‰ê¹”ì€?'},
            18: {type: 'emoji', main: 'ì§€ê¸ˆ ê¸°ë¶„ì„ ì´ëª¨ì§€ë¡œ í‘œí˜„í•˜ë©´?', fake: 'ì–´ì œ ê¸°ë¶„ì„ ì´ëª¨ì§€ë¡œ í‘œí˜„í•˜ë©´?'},
            19: {type: 'player', main: 'ê°€ì¥ ìš”ë¦¬ë¥¼ ì˜í•  ê²ƒ ê°™ì€ í”Œë ˆì´ì–´ëŠ”?', fake: 'ê°€ì¥ ìš´ì „ì„ ëª»í•  ê²ƒ ê°™ì€ í”Œë ˆì´ì–´ëŠ”?'},
            20: {type: 'input', main: 'ê°€ì¥ ê°€ê³  ì‹¶ì€ ì—¬í–‰ì§€ëŠ”?', fake: 'ê°€ì¥ ê°€ê¸° ì‹«ì€ ì—¬í–‰ì§€ëŠ”?'},
            21: {type: 'drawing', main: 'ë‚˜ë¬´ë¥¼ ê·¸ë ¤ì£¼ì„¸ìš”', fake: 'ê½ƒì„ ê·¸ë ¤ì£¼ì„¸ìš”'},
            22: {type: 'number', main: 'ì¼ì£¼ì¼ì— ìš´ë™ì„ ëª‡ ë²ˆ í•˜ë‚˜ìš”?', fake: 'ì¼ì£¼ì¼ì— ì˜í™”ë¥¼ ëª‡ í¸ ë³´ë‚˜ìš”?'},
            23: {type: 'input', main: 'ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ì˜í™” ì¥ë¥´ëŠ”?', fake: 'ê°€ì¥ ì‹«ì–´í•˜ëŠ” ì˜í™” ì¥ë¥´ëŠ”?'},
            24: {type: 'emoji', main: 'ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ì´ëª¨ì§€ëŠ”?', fake: 'ê°€ì¥ ì´í•´ ì•ˆ ë˜ëŠ” ì´ëª¨ì§€ëŠ”?'},
            25: {type: 'player', main: 'ê°€ì¥ ì ì´ ë§ì„ ê²ƒ ê°™ì€ í”Œë ˆì´ì–´ëŠ”?', fake: 'ê°€ì¥ ì¼ì° ì¼ì–´ë‚  ê²ƒ ê°™ì€ í”Œë ˆì´ì–´ëŠ”?'},
            26: {type: 'input', main: 'ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ìš´ë™ì€?', fake: 'ê°€ì¥ ì‹«ì–´í•˜ëŠ” ìš´ë™ì€?'},
            27: {type: 'drawing', main: 'í–„ë²„ê±°ë¥¼ ê·¸ë ¤ì£¼ì„¸ìš”', fake: 'í”¼ìë¥¼ ê·¸ë ¤ì£¼ì„¸ìš”'},
            28: {type: 'number', main: 'í‰ê·  ëª‡ ì‹œì— ì ìë¦¬ì— ë“œë‚˜ìš”?', fake: 'í‰ê·  ëª‡ ì‹œì— ì¼ì–´ë‚˜ë‚˜ìš”?'},
            29: {type: 'input', main: 'ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ì—¬í–‰ì€?', fake: 'ê°€ì¥ í›„íšŒë˜ëŠ” ì—¬í–‰ì€?'},
            30: {type: 'player', main: 'ê°€ì¥ íŒ¨ì…˜ ì„¼ìŠ¤ê°€ ì¢‹ì€ í”Œë ˆì´ì–´ëŠ”?', fake: 'ê°€ì¥ ê°œê·¸ ì„¼ìŠ¤ê°€ ì¢‹ì€ í”Œë ˆì´ì–´ëŠ”?'}
        };

        // ì´ëª¨ì§€ ëª©ë¡
        const emojis = ['ğŸ˜€', 'ğŸ˜‚', 'ğŸ˜', 'ğŸ˜­', 'ğŸ˜', 'ğŸ¤”', 'ğŸ˜´', 'ğŸ˜‹', 'ğŸ¥°', 'ğŸ˜¤', 'ğŸ¤¯', 'ğŸ¥³', 'ğŸ˜·', 'ğŸ¤¢', 'ğŸ¤ ', 'ğŸ˜ˆ', 'ğŸ‘»', 'ğŸ’€', 'ğŸ­', 'ğŸ‘¹', 'ğŸ‘º', 'ğŸ¤¡', 'ğŸ’©', 'ğŸ‘½', 'ğŸ¤–'];

        // í˜ì´ì§€ ì „í™˜
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        // í”Œë ˆì´ì–´ ìˆ˜ ë³€ê²½
        function changePlayerCount(delta) {
            const current = gameState.totalPlayers;
            const newValue = Math.max(3, Math.min(8, current + delta));
            gameState.totalPlayers = newValue;
            document.getElementById('total-players').textContent = newValue;
            
            // í˜ì´ì»¤ ìˆ˜ê°€ ì „ì²´ ì¸ì›ì„ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ì¡°ì •
            if (gameState.fakerCount >= newValue) {
                gameState.fakerCount = Math.max(1, newValue - 1);
                document.getElementById('faker-count').textContent = gameState.fakerCount;
            }
        }

        // í˜ì´ì»¤ ìˆ˜ ë³€ê²½
        function changeFakerCount(delta) {
            const current = gameState.fakerCount;
            const maxFakers = Math.max(1, gameState.totalPlayers - 1);
            const newValue = Math.max(1, Math.min(maxFakers, current + delta));
            gameState.fakerCount = newValue;
            document.getElementById('faker-count').textContent = newValue;
        }

        // ì•ŒíŒŒë²³ì„ ìˆ«ìë¡œ ë³€í™˜
        function letterToNumber(letter) {
            return letter.charCodeAt(0) - 96; // a=1, b=2, ...
        }

        // í˜ì´ì»¤ ì—¬ë¶€ í™•ì¸
        function isFakerCode(code) {
            const sum = code.split('').reduce((acc, letter) => acc + letterToNumber(letter), 0);
            const firstDigit = parseInt(sum.toString()[0]);
            return firstDigit === 3 || firstDigit === 7;
        }

        // ì´ˆëŒ€ì½”ë“œ ìƒì„±
        function generateInviteCodes() {
            gameState.isHost = true;
            gameState.inviteCodes = [];
            
            // ê° ë¼ìš´ë“œì˜ í–‰ ì„ íƒ
            const selectedRows = [];
            for (let round = 0; round < 4; round++) {
                selectedRows.push([
                    Math.floor(Math.random() * 6), // set1 í–‰
                    Math.floor(Math.random() * 6), // set2 í–‰  
                    Math.floor(Math.random() * 6), // set3 í–‰
                    Math.floor(Math.random() * 6)  // set4 í–‰
                ]);
            }

            let fakerCodes = 0;
            const normalCodes = [];

            // ì¼ë°˜ í”Œë ˆì´ì–´ ì½”ë“œ ìƒì„±
            for (let i = 0; i < gameState.totalPlayers - gameState.fakerCount; i++) {
                let code;
                do {
                    code = generateSingleCode(selectedRows);
                } while (isFakerCode(code));
                normalCodes.push(code);
            }

            // í˜ì´ì»¤ ì½”ë“œ ìƒì„±
            for (let i = 0; i < gameState.fakerCount; i++) {
                let code;
                do {
                    code = generateSingleCode(selectedRows);
                } while (!isFakerCode(code));
                gameState.inviteCodes.push(code);
            }

            // ì¼ë°˜ ì½”ë“œ ì¶”ê°€
            gameState.inviteCodes.push(...normalCodes);

            // ì½”ë“œ ì„ê¸°
            gameState.inviteCodes.sort(() => Math.random() - 0.5);

            displayInviteCodes();
            showPage('invite-codes');
        }

        // ë‹¨ì¼ ì½”ë“œ ìƒì„±
        function generateSingleCode(selectedRows) {
            const roundIndex = Math.floor(Math.random() * 4);
            const rows = selectedRows[roundIndex];
            
            let code = '';
            const sets = ['set1', 'set2', 'set3', 'set4'];
            
            for (let i = 0; i < 4; i++) {
                const setData = alphabetSets[sets[i]][rows[i]];
                const randomLetter = setData.letters[Math.floor(Math.random() * 4)];
                code += randomLetter;
            }
            
            return code.toUpperCase();
        }

        // ì´ˆëŒ€ì½”ë“œ í‘œì‹œ
        function displayInviteCodes() {
            const container = document.getElementById('codes-container');
            container.innerHTML = '';
            
            gameState.inviteCodes.forEach((code, index) => {
                const codeDiv = document.createElement('div');
                codeDiv.className = 'invite-code';
                codeDiv.innerHTML = `
                    <h4>í”Œë ˆì´ì–´ ${index + 1}</h4>
                    <div class="code">${code}</div>
                    <small>ì´ ì½”ë“œë¥¼ ê° í”Œë ˆì´ì–´ì—ê²Œ ì „ë‹¬í•˜ì„¸ìš”</small>
                `;
                container.appendChild(codeDiv);
            });
        }

        // ê²Œì„ ì°¸ì—¬
        function joinGame() {
            const code = document.getElementById('invite-code-input').value.toUpperCase();
            if (code.length !== 4) {
                alert('4ìë¦¬ ì•ŒíŒŒë²³ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            gameState.isHost = false;
            gameState.isFaker = isFakerCode(code);
            gameState.playerRole = gameState.isFaker ? 'í˜ì´ì»¤' : 'ì¼ë°˜ í”Œë ˆì´ì–´';
            
            // ì½”ë“œë¡œë¶€í„° ì§ˆë¬¸ ë²ˆí˜¸ ì¶”ì¶œ
            extractQuestionsFromCode(code);
            
            startGame();
        }

        // í˜¸ìŠ¤íŠ¸ ê²Œì„ ì‹œì‘
        function startHostGame() {
            // ì²« ë²ˆì§¸ ì½”ë“œë¡œ ì§ˆë¬¸ ì¶”ì¶œ (í˜¸ìŠ¤íŠ¸ìš©)
            extractQuestionsFromCode(gameState.inviteCodes[0]);
            gameState.isFaker = isFakerCode(gameState.inviteCodes[0]);
            gameState.playerRole = 'í˜¸ìŠ¤íŠ¸';
            startGame();
        }

        // ì½”ë“œì—ì„œ ì§ˆë¬¸ ë²ˆí˜¸ ì¶”ì¶œ
        function extractQuestionsFromCode(code) {
            const letters = code.toLowerCase().split('');
            gameState.questions = [];
            
            // ê° ë¼ìš´ë“œë³„ ì§ˆë¬¸ ë²ˆí˜¸ ì¶”ì¶œ
            for (let round = 0; round < 4; round++) {
                const roundQuestions = [];
                
                // ê° ì„¸íŠ¸ì—ì„œ í•´ë‹¹ ê¸€ìê°€ ìˆëŠ” í–‰ ì°¾ê¸°
                const sets = ['set1', 'set2', 'set3', 'set4'];
                for (let setIndex = 0; setIndex < 4; setIndex++) {
                    const setData = alphabetSets[sets[setIndex]];
                    for (let rowIndex = 0; rowIndex < setData.length; rowIndex++) {
                        if (setData[rowIndex].letters.includes(letters[setIndex])) {
                            roundQuestions.push(setData[rowIndex].numbers[setIndex]);
                            break;
                        }
                    }
                }
                
                gameState.questions.push(roundQuestions);
            }
        }

        // ê²Œì„ ì‹œì‘
        function startGame() {
            initializeScores();
            loadCurrentQuestion();
            showPage('game-page');
            
            if (gameState.isHost) {
                document.getElementById('host-controls').classList.remove('hidden');
                setupScoreManagement();
            } else {
                document.getElementById('player-controls').classList.remove('hidden');
            }
            
            updateGameHeader();
            updateRoleDisplay();
        }

        // ì ìˆ˜ ì´ˆê¸°í™”
        function initializeScores() {
            gameState.scores = {};
            for (let i = 0; i < gameState.totalPlayers; i++) {
                gameState.scores[`í”Œë ˆì´ì–´${i + 1}`] = 0;
            }
        }

        // í˜„ì¬ ì§ˆë¬¸ ë¡œë“œ
        function loadCurrentQuestion() {
            const roundIndex = gameState.currentRound - 1;
            const questionNumbers = gameState.questions[roundIndex];
            const questionIndex = Math.floor(Math.random() * questionNumbers.length);
            const questionId = questionNumbers[questionIndex];
            
            const question = questionDB[questionId];
            if (!question) return;
            
            gameState.currentQuestionType = question.type;
            
            // ì§ˆë¬¸ í‘œì‹œ
            document.getElementById('question-type').textContent = getQuestionTypeText(question.type);
            
            if (gameState.isFaker) {
                document.getElementById('question-text').textContent = question.fake;
            } else {
                document.getElementById('question-text').textContent = question.main;
            }
            
            // ë‹µë³€ ì…ë ¥ ë°©ì‹ ì„¤ì •
            setupAnswerInput(question.type);
        }

        // ì§ˆë¬¸ íƒ€ì… í…ìŠ¤íŠ¸
        function getQuestionTypeText(type) {
            switch(type) {
                case 'input': return 'ğŸ“ ì…ë ¥í˜• ì§ˆë¬¸';
                case 'drawing': return 'ğŸ¨ ê·¸ë¦¼ ëª¨ë“œ';
                case 'number': return 'ğŸ”¢ ìˆ«ì ëª¨ë“œ';
                case 'emoji': return 'ğŸ˜€ ì´ëª¨ì§€ ëª¨ë“œ';
                case 'player': return 'ğŸ‘¥ í”Œë ˆì´ì–´ ì„ íƒ ëª¨ë“œ';
                default: return 'ì§ˆë¬¸';
            }
        }

        // ë‹µë³€ ì…ë ¥ ë°©ì‹ ì„¤ì •
        function setupAnswerInput(type) {
            // ëª¨ë“  ì…ë ¥ ë°©ì‹ ìˆ¨ê¸°ê¸°
            document.getElementById('answer-input').classList.add('hidden');
            document.getElementById('drawing-canvas').classList.add('hidden');
            document.getElementById('emoji-section').classList.add('hidden');
            document.getElementById('player-select').classList.add('hidden');
            
            switch(type) {
                case 'input':
                case 'number':
                    document.getElementById('answer-input').classList.remove('hidden');
                    if (type === 'number') {
                        document.getElementById('answer-input').type = 'number';
                        document.getElementById('answer-input').placeholder = 'ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”...';
                    } else {
                        document.getElementById('answer-input').type = 'text';
                        document.getElementById('answer-input').placeholder = 'ì—¬ê¸°ì— ë‹µì„ ì…ë ¥í•˜ì„¸ìš”...';
                    }
                    break;
                case 'drawing':
                    document.getElementById('drawing-canvas').classList.remove('hidden');
                    setupCanvas();
                    break;
                case 'emoji':
                    document.getElementById('emoji-section').classList.remove('hidden');
                    setupEmojiGrid();
                    break;
                case 'player':
                    document.getElementById('player-select').classList.remove('hidden');
                    setupPlayerSelection();
                    break;
            }
        }

        // ìº”ë²„ìŠ¤ ì„¤ì •
        function setupCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            
            // í„°ì¹˜ ë° ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
            function startDrawing(e) {
                isDrawing = true;
                draw(e);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, y);
            }
            
            function stopDrawing() {
                if (!isDrawing) return;
                isDrawing = false;
                ctx.beginPath();
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
            
            // ì§€ìš°ê¸° ë²„íŠ¼ ì¶”ê°€
            if (!document.getElementById('clear-canvas-btn')) {
                const clearBtn = document.createElement('button');
                clearBtn.id = 'clear-canvas-btn';
                clearBtn.className = 'btn btn-secondary';
                clearBtn.textContent = 'ğŸ—‘ï¸ ì§€ìš°ê¸°';
                clearBtn.onclick = () => {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                };
                canvas.parentNode.insertBefore(clearBtn, canvas.nextSibling);
            }
        }

        // ì´ëª¨ì§€ ê·¸ë¦¬ë“œ ì„¤ì •
        function setupEmojiGrid() {
            const grid = document.getElementById('emoji-grid');
            grid.innerHTML = '';
            
            emojis.forEach(emoji => {
                const btn = document.createElement('button');
                btn.className = 'emoji-btn';
                btn.textContent = emoji;
                btn.onclick = () => {
                    document.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    gameState.currentAnswer = emoji;
                };
                grid.appendChild(btn);
            });
        }

        // í”Œë ˆì´ì–´ ì„ íƒ ì„¤ì •
        function setupPlayerSelection() {
            const container = document.getElementById('player-select');
            const votingDiv = document.getElementById('player-voting');
            votingDiv.innerHTML = '';
            
            for (let i = 0; i < gameState.totalPlayers; i++) {
                const btn = document.createElement('button');
                btn.className = 'player-btn';
                btn.textContent = gameState.isHost && i === 0 ? 'í˜¸ìŠ¤íŠ¸' : `í”Œë ˆì´ì–´ ${i + 1}`;
                btn.onclick = () => {
                    document.querySelectorAll('#player-voting .player-btn').forEach(b => 
                        b.classList.remove('selected'));
                    btn.classList.add('selected');
                    gameState.currentAnswer = btn.textContent;
                };
                votingDiv.appendChild(btn);
            }
        }

        // ë‹µë³€ ì œì¶œ
        function submitAnswer() {
            switch(gameState.currentQuestionType) {
                case 'input':
                case 'number':
                    gameState.currentAnswer = document.getElementById('answer-input').value;
                    break;
                case 'drawing':
                    gameState.currentAnswer = 'ê·¸ë¦¼ì„ ê·¸ë ¸ìŠµë‹ˆë‹¤';
                    break;
                case 'emoji':
                case 'player':
                    // ì´ë¯¸ ì„ íƒì‹œ ì €ì¥ë¨
                    break;
            }
            
            if (!gameState.currentAnswer || gameState.currentAnswer.trim() === '') {
                alert('ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë‹µë³€ ìˆ¨ê¸°ê¸°
            document.getElementById('answer-section').classList.add('hidden');
            document.getElementById('submit-answer').classList.add('hidden');
            document.getElementById('after-submit').classList.remove('hidden');
        }

        // ë‹µ ê³µê°œ
        function revealAnswer() {
            document.getElementById('after-submit').classList.add('hidden');
            document.getElementById('reveal-section').classList.remove('hidden');
            
            // ë‚´ ë‹µë³€ í‘œì‹œ
            document.getElementById('my-answer').innerHTML = `
                <div class="question-text">${gameState.currentAnswer}</div>
            `;
            
            // í˜ì´ì»¤ì¸ ê²½ìš° ì‹¤ì œ ì§ˆë¬¸ í‘œì‹œ
            if (gameState.isFaker) {
                document.getElementById('faker-hint').classList.remove('hidden');
                const roundIndex = gameState.currentRound - 1;
                const questionNumbers = gameState.questions[roundIndex];
                const questionId = questionNumbers[0];
                const realQuestion = questionDB[questionId]?.main || 'ì§ˆë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                document.getElementById('real-question').textContent = realQuestion;
            }
            
            // íˆ¬í‘œ ì„¹ì…˜ ì„¤ì •
            setupVotingSection();
        }

        // íˆ¬í‘œ ì„¹ì…˜ ì„¤ì •
        function setupVotingSection() {
            const votingSection = document.getElementById('voting-section');
            votingSection.innerHTML = '';
            
            for (let i = 0; i < gameState.totalPlayers; i++) {
                const btn = document.createElement('button');
                btn.className = 'player-btn';
                btn.textContent = gameState.isHost && i === 0 ? 'í˜¸ìŠ¤íŠ¸' : `í”Œë ˆì´ì–´ ${i + 1}`;
                btn.onclick = () => {
                    document.querySelectorAll('#voting-section .player-btn').forEach(b => 
                        b.classList.remove('selected'));
                    btn.classList.add('selected');
                    
                    // íˆ¬í‘œ ì²˜ë¦¬ (ì‹¤ì œë¡œëŠ” ê° í”Œë ˆì´ì–´ì˜ í•¸ë“œí°ì—ì„œ ê°œë³„ì ìœ¼ë¡œ ì²˜ë¦¬)
                    alert(`${btn.textContent}ì—ê²Œ íˆ¬í‘œí–ˆìŠµë‹ˆë‹¤!`);
                };
                votingSection.appendChild(btn);
            }
        }

        // ì ìˆ˜ ê´€ë¦¬ ì„¤ì • (í˜¸ìŠ¤íŠ¸ìš©)
        function setupScoreManagement() {
            const container = document.getElementById('score-management');
            container.innerHTML = '';
            
            Object.keys(gameState.scores).forEach(player => {
                const scoreDiv = document.createElement('div');
                scoreDiv.className = 'score-counter';
                scoreDiv.innerHTML = `
                    <span>${player}</span>
                    <div>
                        <button class="counter-btn minus" onclick="changeScore('${player}', -1)">-</button>
                        <span id="score-${player}">${gameState.scores[player]}</span>
                        <button class="counter-btn plus" onclick="changeScore('${player}', 1)">+</button>
                    </div>
                `;
                container.appendChild(scoreDiv);
            });
        }

        // ì ìˆ˜ ë³€ê²½
        function changeScore(player, delta) {
            gameState.scores[player] = Math.max(0, gameState.scores[player] + delta);
            document.getElementById(`score-${player}`).textContent = gameState.scores[player];
        }

        // í˜ì´ì»¤ í¬ê¸°
        function fakerGiveUp() {
            alert('í˜ì´ì»¤ê°€ í¬ê¸°í–ˆìŠµë‹ˆë‹¤!');
            document.querySelector('#host-controls .btn-success').classList.remove('hidden');
            document.querySelector('#player-controls .btn-success')?.classList.remove('hidden');
        }

        // í˜ì´ì»¤ ê³µê°œ
        function revealFaker() {
            const btn = document.getElementById('reveal-faker-btn');
            if (btn.textContent === 'í˜ì´ì»¤ ê³µê°œ') {
                btn.textContent = 'ì •ë§ë¡œ ê³µê°œí•˜ë‚˜ìš”?';
                btn.className = 'btn btn-danger';
            } else {
                alert(`í˜ì´ì»¤ëŠ” ${gameState.isFaker ? 'ë‹¹ì‹ ' : 'ë‹¤ë¥¸ í”Œë ˆì´ì–´'}ì…ë‹ˆë‹¤!`);
                btn.textContent = 'í˜ì´ì»¤ ê³µê°œ';
                btn.className = 'btn btn-secondary';
            }
        }

        // ë‹¤ìŒ ë¼ìš´ë“œ
        function nextRound() {
            if (gameState.currentRound >= 4) {
                alert('ê²Œì„ì´ ëë‚¬ìŠµë‹ˆë‹¤! ìµœì¢… ì ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                showFinalScores();
                return;
            }
            
            gameState.currentRound++;
            
            // í˜ì´ì§€ ì´ˆê¸°í™”
            document.getElementById('answer-section').classList.remove('hidden');
            document.getElementById('submit-answer').classList.remove('hidden');
            document.getElementById('after-submit').classList.add('hidden');
            document.getElementById('reveal-section').classList.add('hidden');
            document.getElementById('faker-hint').classList.add('hidden');
            
            // ì…ë ¥ ì´ˆê¸°í™”
            document.getElementById('answer-input').value = '';
            gameState.currentAnswer = '';
            
            // ìƒˆ ì§ˆë¬¸ ë¡œë“œ
            loadCurrentQuestion();
            updateGameHeader();
        }

        // ìµœì¢… ì ìˆ˜ í‘œì‹œ
        function showFinalScores() {
            let scoreText = 'ğŸ† ìµœì¢… ì ìˆ˜ ğŸ†\n\n';
            Object.entries(gameState.scores)
                .sort(([,a], [,b]) => b - a)
                .forEach(([player, score], index) => {
                    const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : 'ğŸ…';
                    scoreText += `${medal} ${player}: ${score}ì \n`;
                });
            
            alert(scoreText);
        }

        // ê²Œì„ í—¤ë” ì—…ë°ì´íŠ¸
        function updateGameHeader() {
            document.getElementById('game-header').textContent = `ë¼ìš´ë“œ ${gameState.currentRound}`;
        }

        // ì—­í•  í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateRoleDisplay() {
            const roleDisplay = document.getElementById('role-display');
            if (gameState.isFaker) {
                roleDisplay.textContent = 'ğŸ­ ë‹¹ì‹ ì€ í˜ì´ì»¤ì…ë‹ˆë‹¤!';
                roleDisplay.style.color = '#ff6b6b';
            } else {
                roleDisplay.textContent = 'ğŸ•µï¸ í˜ì´ì»¤ë¥¼ ì°¾ì•„ë³´ì„¸ìš”!';
                roleDisplay.style.color = '#51cf66';
            }
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // í„°ì¹˜ ìŠ¤í¬ë¡¤ ë°©ì§€ (ìº”ë²„ìŠ¤ ì˜ì—­ì—ì„œ)
            document.addEventListener('touchmove', function(e) {
                if (e.target.tagName === 'CANVAS') {
                    e.preventDefault();
                }
            }, { passive: false });
        });
    </script>
</body>
</html>